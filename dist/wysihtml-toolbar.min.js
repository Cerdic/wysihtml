/* wysihtml5x v0.5.0-beta3 https://github.com/Edicy/wysihtml5 Author: Christopher Blum (https://github.com/tiff) Secondary author of extended features: Oliver Pulges (https://github.com/pulges) Copyright (C) 2012 XING AG Licensed under the MIT license (MIT) */ String.prototype.trim||function(){var a=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(a,"")}}(); (function(){Event.prototype.preventDefault||(Event.prototype.preventDefault=function(){this.returnValue=!1});Event.prototype.stopPropagation||(Event.prototype.stopPropagation=function(){this.cancelBubble=!0});if(!Element.prototype.addEventListener){var a=[],f=function(b,d){var f=this,h=function(e){e.target=e.srcElement;e.currentTarget=f;d.handleEvent?d.handleEvent(e):d.call(f,e)};if("DOMContentLoaded"==b){var e=function(e){"complete"==document.readyState&&h(e)};document.attachEvent("onreadystatechange", e);a.push({object:this,type:b,listener:d,wrapper:e});if("complete"==document.readyState){var l=new Event;l.srcElement=window;e(l)}}else this.attachEvent("on"+b,h),a.push({object:this,type:b,listener:d,wrapper:h})},b=function(b,d){for(var f=0;f<a.length;){var h=a[f];if(h.object==this&&h.type==b&&h.listener==d){"DOMContentLoaded"==b?this.detachEvent("onreadystatechange",h.wrapper):this.detachEvent("on"+b,h.wrapper);a.splice(f,1);break}++f}};Element.prototype.addEventListener=f;Element.prototype.removeEventListener= b;HTMLDocument&&(HTMLDocument.prototype.addEventListener=f,HTMLDocument.prototype.removeEventListener=b);Window&&(Window.prototype.addEventListener=f,Window.prototype.removeEventListener=b)}})(); Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&function(){var a=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return a.get.call(this)},set:function(f){return a.set.call(this,f)}})}();Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}); Array.prototype.indexOf||(Array.prototype.indexOf=function(a,f){for(var b=this.length,g=-1,d=f>>>0;~(b-d);g=this[--b]===a?b:g);return g}); Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var f=Array.prototype.slice.call(arguments,1),b=this,g=function(){},d=function(){return b.apply(this instanceof g&&a?this:a,f.concat(Array.prototype.slice.call(arguments)))};g.prototype=this.prototype;d.prototype=new g;return d}); this.Element&&function(a){a.matches=a.matches||a.matchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){a=(this.parentNode||this.document).querySelectorAll(a);for(var b=-1;a[++b]&&a[b]!=this;);return!!a[b]}}(Element.prototype); "document"in self&&("classList"in document.createElement("_")?"DOMTokenList"in window&&function(){var a=document.createElement("_");a.classList.add("c1","c2");if(!a.classList.contains("c2")){var f=function(a){var d=DOMTokenList.prototype[a];DOMTokenList.prototype[a]=function(a){var b,e=arguments.length;for(b=0;b<e;b++)a=arguments[b],d.call(this,a)}};f("add");f("remove")}a.classList.toggle("c3",!1);if(a.classList.contains("c3")){var b=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(a, d){return 1 in arguments&&!this.contains(a)===!d?d:b.call(this,a)}}a=null}():function(a){if("Element"in a){a=a.Element.prototype;var f=Object,b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array.prototype.indexOf||function(a){for(var e=0,d=this.length;e<d;e++)if(e in this&&this[e]===a)return e;return-1},d=function(e,a){this.name=e;this.code=DOMException[e];this.message=a},k=function(e,a){if(""===a)throw new d("SYNTAX_ERR","An invalid or illegal string was specified"); if(/\s/.test(a))throw new d("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(e,a)},h=function(e){for(var a=b.call(e.getAttribute("class")||""),a=a?a.split(/\s+/):[],d=0,f=a.length;d<f;d++)this.push(a[d]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},e=h.prototype=[],l=function(){return new h(this)};d.prototype=Error.prototype;e.item=function(a){return this[a]||null};e.contains=function(a){return-1!==k(this,a+"")};e.add=function(){var a=arguments, e=0,d=a.length,b,f=!1;do b=a[e]+"",-1===k(this,b)&&(this.push(b),f=!0);while(++e<d);f&&this._updateClassName()};e.remove=function(){var a=arguments,e=0,d=a.length,b,f=!1,h;do for(b=a[e]+"",h=k(this,b);-1!==h;)this.splice(h,1),f=!0,h=k(this,b);while(++e<d);f&&this._updateClassName()};e.toggle=function(a,e){a+="";var d=this.contains(a),b=d?!0!==e&&"remove":!1!==e&&"add";if(b)this[b](a);return!0===e||!1===e?e:!d};e.toString=function(){return this.join(" ")};if(f.defineProperty){e={get:l,enumerable:!0, configurable:!0};try{f.defineProperty(a,"classList",e)}catch(p){-2146823252===p.number&&(e.enumerable=!1,f.defineProperty(a,"classList",e))}}else f.prototype.__defineGetter__&&a.__defineGetter__("classList",l)}}(self)); var wysihtml5={version:"0.5.0-beta3",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46}; (function(a,f){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a():f.rangy=a()})(function(){function a(a,e){var d=typeof a[e];return"function"==d||!("object"!=d||!a[e])||"unknown"==d}function f(a,e){return!("object"!=typeof a[e]||!a[e])}function b(a,e){return"undefined"!=typeof a[e]}function g(a){return function(e,d){for(var b=d.length;b--;)if(!a(e,d[b]))return!1;return!0}}function d(a){return a&&x(a,w)&&D(a,t)}function k(a){return f(a, "body")?a.body:a.getElementsByTagName("body")[0]}function h(e){"undefined"!=typeof console&&a(console,"log")&&console.log(e)}function e(a){y.initialized=!0;y.supported=!1;a="Rangy is not supported in this environment. Reason: "+a;A&&y.config.alertOnFail?alert(a):h(a)}function l(){if(A&&!y.initialized){var b,f=!1,g=!1;a(document,"createRange")&&(b=document.createRange(),x(b,v)&&D(b,r)&&(f=!0));if((b=k(document))&&"body"==b.nodeName.toLowerCase())if(b&&a(b,"createTextRange")&&(b=b.createTextRange(), d(b)&&(g=!0)),f||g){y.initialized=!0;y.features={implementsDomRange:f,implementsTextRange:g};var l,n;for(n in F)(l=F[n])instanceof m&&l.init(l,y);g=0;for(l=T.length;g<l;++g)try{T[g](y)}catch(p){f="Rangy init listener threw an exception. Continuing. Detail: "+(p.message||p.description||String(p)),h(f)}}else e("Neither Range nor TextRange are available");else e("No body element found")}}function p(a){a=a||window;l();for(var e=0,d=M.length;e<d;++e)M[e](a)}function m(a,e,d){this.name=a;this.dependencies= e;this.supported=this.initialized=!1;this.initializer=d}function n(a,e,d){e=new m(a,e,function(e){if(!e.initialized){e.initialized=!0;try{d(y,e),e.supported=!0}catch(b){h("Module '"+a+"' failed to load: "+(b.message||b.description||String(b))),b.stack&&h(b.stack)}}});return F[a]=e}function q(){}var r="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),v="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "), t="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),w="collapse compareEndPoints duplicate moveToElementText parentElement select setEndPoint getBoundingClientRect".split(" "),x=g(a),B=g(f),D=g(b),F={},A="undefined"!=typeof window&&"undefined"!=typeof document,G={isHostMethod:a,isHostObject:f,isHostProperty:b,areHostMethods:x,areHostObjects:B,areHostProperties:D,isTextRange:d,getBody:k},y={version:"1.3.0-alpha.20140921",initialized:!1,isBrowser:A,supported:!0,util:G, features:{},modules:F,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==typeof rangyAutoInitialize?!0:rangyAutoInitialize}};y.fail=e;y.warn=function(a){a="Rangy warning: "+a;A&&y.config.alertOnWarn?alert(a):h(a)};var H;({}).hasOwnProperty?(G.extend=H=function(a,e,d){var b,f,h;for(h in e)e.hasOwnProperty(h)&&(b=a[h],f=e[h],d&&null!==b&&"object"==typeof b&&null!==f&&"object"==typeof f&&H(b,f,!0),a[h]=f);e.hasOwnProperty("toString")&&(a.toString=e.toString);return a}, G.createOptions=function(a,e){var d={};H(d,e);a&&H(d,a);return d}):e("hasOwnProperty not supported");A||e("Rangy can only run in a browser");(function(){var a;if(A){var e=document.createElement("div");e.appendChild(document.createElement("span"));var d=[].slice;try{1==d.call(e.childNodes,0)[0].nodeType&&(a=function(a){return d.call(a,0)})}catch(b){}}a||(a=function(a){for(var e=[],d=0,b=a.length;d<b;++d)e[d]=a[d];return e});G.toArray=a})();var N;A&&(a(document,"addEventListener")?N=function(a,e,d){a.addEventListener(e, d,!1)}:a(document,"attachEvent")?N=function(a,e,d){a.attachEvent("on"+e,d)}:e("Document does not have required addEventListener or attachEvent method"),G.addListener=N);var T=[];y.init=l;y.addInitListener=function(a){y.initialized?a(y):T.push(a)};var M=[];y.addShimListener=function(a){M.push(a)};A&&(y.shim=y.createMissingNativeApi=p);m.prototype={init:function(){for(var a=this.dependencies||[],e=0,d=a.length,b,f;e<d;++e){f=a[e];b=F[f];if(!(b&&b instanceof m))throw Error("required module '"+f+"' not found"); b.init();if(!b.supported)throw Error("required module '"+f+"' not supported");}this.initializer(this)},fail:function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);},warn:function(a){y.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,e){y.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+e+" instead")},createError:function(a){return Error("Error in Rangy "+this.name+" module: "+a)}};y.createModule=function(a){var e, d;2==arguments.length?(e=arguments[1],d=[]):(e=arguments[2],d=arguments[1]);e=n(a,d,e);y.initialized&&y.supported&&e.init()};y.createCoreModule=function(a,e,d){n(a,e,d)};y.RangePrototype=q;y.rangePrototype=new q;y.selectionPrototype=new function(){};y.createCoreModule("DomUtil",[],function(a,e){function d(a){for(var e=0;a=a.previousSibling;)++e;return e}function b(a,e){var d=[],f;for(f=a;f;f=f.parentNode)d.push(f);for(f=e;f;f=f.parentNode)if(y(d,f))return f;return null}function f(a,e,d){for(e=d?e: e.parentNode;e;){if(e===a)return!0;e=e.parentNode}return!1}function h(a,e,d){for(d=d?a:a.parentNode;d;){a=d.parentNode;if(a===e)return d;d=a}return null}function g(a){a=a.nodeType;return 3==a||4==a||8==a}function k(a,e){var d=e.nextSibling,b=e.parentNode;d?b.insertBefore(a,d):b.appendChild(a);return a}function l(a){if(9==a.nodeType)return a;if("undefined"!=typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return l(a.parentNode);throw e.createError("getDocument: no document found for node"); }function n(a){a=l(a);if("undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw e.createError("Cannot get a window object for node");}function p(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw e.createError("getIframeDocument: No Document object found for iframe element");}function m(a){return a&&t.isHostMethod(a,"setTimeout")&&t.isHostObject(a, "document")}function q(a){return a?g(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">[index:"+d(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":a.nodeName:"[No node]"}function r(a){this._next=this.root=a}function x(a,e){this.node=a;this.offset=e}function v(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}var t=a.util;t.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])|| e.fail("document missing a Node creation method");t.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var A=document.createElement("div");t.areHostMethods(A,["insertBefore","appendChild","cloneNode"])||e.fail("Incomplete Element implementation");t.isHostProperty(A,"innerHTML")||e.fail("Element is missing innerHTML property");A=document.createTextNode("test");t.areHostMethods(A,["splitText","deleteData","insertData","appendData","cloneNode"])||e.fail("Incomplete Text Node implementation"); var y=function(a,e){for(var d=a.length;d--;)if(a[d]===e)return!0;return!1},w=!1;(function(){var e=document.createElement("b");e.innerHTML="1";e.innerHTML="<br>";w=!1;a.features.crashyTextNodes=w})();var B;"undefined"!=typeof window.getComputedStyle?B=function(a,e){return n(a).getComputedStyle(a,null)[e]}:"undefined"!=typeof document.documentElement.currentStyle?B=function(a,e){return a.currentStyle[e]}:e.fail("No means of obtaining computed style properties found");r.prototype={_current:null,hasNext:function(){return!!this._next}, next:function(){var a=this._current=this._next,e;if(this._current){e=a.firstChild;if(!e)for(e=null;a!==this.root&&!(e=a.nextSibling);)a=a.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}};x.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+q(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};v.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3, WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};v.prototype.toString=function(){return this.message};a.dom={arrayContains:y,isHtmlNamespace:function(a){var e;return"undefined"==typeof a.namespaceURI||null===(e=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==e},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:d,getNodeLength:function(a){switch(a.nodeType){case 7:case 10:return 0; case 3:case 8:return a.length;default:return a.childNodes.length}},getCommonAncestor:b,isAncestorOf:f,isOrIsAncestorOf:function(a,e){return f(a,e,!0)},getClosestAncestorIn:h,isCharacterDataNode:g,isTextOrCommentNode:function(a){if(!a)return!1;a=a.nodeType;return 3==a||8==a},insertAfter:k,splitDataNode:function(a,e,b){var f=a.cloneNode(!1);f.deleteData(0,e);a.deleteData(e,a.length-e);k(f,a);if(b)for(var h=0,g;g=b[h++];)g.node==a&&g.offset>e?(g.node=f,g.offset-=e):g.node==a.parentNode&&g.offset>d(a)&& ++g.offset;return f},getDocument:l,getWindow:n,getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw e.createError("getIframeWindow: No Window object found for iframe element");},getIframeDocument:p,getBody:t.getBody,isWindow:m,getContentDocument:function(a,e,d){var b;a?t.isHostProperty(a,"nodeType")?b=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?p(a):l(a):m(a)&&(b=a.document): b=document;if(!b)throw e.createError(d+"(): Parameter must be a Window object or DOM node");return b},getRootContainer:function(a){for(var e;e=a.parentNode;)a=e;return a},comparePoints:function(a,f,g,k){var l;if(a==g)return f===k?0:f<k?-1:1;if(l=h(g,a,!0))return f<=d(l)?-1:1;if(l=h(a,g,!0))return d(l)<k?-1:1;f=b(a,g);if(!f)throw Error("comparePoints error: nodes have no common ancestor");a=a===f?f:h(a,f,!0);g=g===f?f:h(g,f,!0);if(a===g)throw e.createError("comparePoints got to case 4 and childA and childB are the same!"); for(f=f.firstChild;f;){if(f===a)return-1;if(f===g)return 1;f=f.nextSibling}},isBrokenNode:function(a){return!1},inspectNode:q,getComputedStyleProperty:B,fragmentFromNodeChildren:function(a){for(var e=l(a).createDocumentFragment(),d;d=a.firstChild;)e.appendChild(d);return e},createIterator:function(a){return new r(a)},DomPosition:x};a.DOMException=v});y.createCoreModule("DomRange",["DomUtil"],function(a,e){function d(a,e){return 3!=a.nodeType&&(U(a,e.startContainer)||U(a,e.endContainer))}function b(a){return a.document|| ca(a.startContainer)}function f(a){return new Z(a.parentNode,O(a))}function h(a){return new Z(a.parentNode,O(a)+1)}function g(a,e,d){var b=11==a.nodeType?a.firstChild:a;u(e)?d==e.length?z.insertAfter(a,e):e.parentNode.insertBefore(a,0==d?e:ga(e,d)):d>=e.childNodes.length?e.appendChild(a):e.insertBefore(a,e.childNodes[d]);return b}function k(a,e,d){E(a);E(e);if(b(e)!=b(a))throw new I("WRONG_DOCUMENT_ERR");var f=C(a.startContainer,a.startOffset,e.endContainer,e.endOffset);a=C(a.endContainer,a.endOffset, e.startContainer,e.startOffset);return d?0>=f&&0<=a:0>f&&0<a}function l(a){for(var e,d,f=b(a.range).createDocumentFragment();d=a.next();){e=a.isPartiallySelectedSubtree();d=d.cloneNode(!e);e&&(e=a.getSubtreeIterator(),d.appendChild(l(e)),e.detach());if(10==d.nodeType)throw new I("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function n(a,e,d){var b,f;for(d=d||{stop:!1};b=a.next();)if(a.isPartiallySelectedSubtree())if(!1===e(b)){d.stop=!0;break}else{if(b=a.getSubtreeIterator(),n(b,e,d),b.detach(), d.stop)break}else for(b=z.createIterator(b);f=b.next();)if(!1===e(f)){d.stop=!0;return}}function p(a){for(var e;a.next();)a.isPartiallySelectedSubtree()?(e=a.getSubtreeIterator(),p(e),e.detach()):a.remove()}function m(a){for(var e,d=b(a.range).createDocumentFragment(),f;e=a.next();){a.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),f=a.getSubtreeIterator(),e.appendChild(m(f)),f.detach()):a.remove();if(10==e.nodeType)throw new I("HIERARCHY_REQUEST_ERR");d.appendChild(e)}return d}function q(a,e,d){var b= !(!e||!e.length),f,h=!!d;b&&(f=new RegExp("^("+e.join("|")+")$"));var g=[];n(new x(a,!1),function(e){if(!b||f.test(e.nodeType))if(!h||d(e)){var k=a.startContainer;e==k&&u(k)&&a.startOffset==k.length||(k=a.endContainer,e==k&&u(k)&&0==a.endOffset||g.push(e))}});return g}function r(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+z.inspectNode(a.startContainer)+":"+a.startOffset+", "+z.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function x(a,e){this.range=a;this.clonePartiallySelectedTextNodes= e;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var d=a.commonAncestorContainer;this.sc===this.ec&&u(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==d||u(this.sc)?aa(this.sc,d,!0):this.sc.childNodes[this.so],this._last=this.ec!==d||u(this.ec)?aa(this.ec,d,!0):this.ec.childNodes[this.eo-1])}}function v(a){return function(e,d){for(var b,f=d?e:e.parentNode;f;){b=f.nodeType; if(ba(a,b))return f;f=f.parentNode}return null}}function t(a,e){if(sa(a,e))throw new I("INVALID_NODE_TYPE_ERR");}function A(a,e){if(!ba(e,a.nodeType))throw new I("INVALID_NODE_TYPE_ERR");}function y(a,e){if(0>e||e>(u(a)?a.length:a.childNodes.length))throw new I("INDEX_SIZE_ERR");}function w(a,e){if(ma(a,!0)!==ma(e,!0))throw new I("WRONG_DOCUMENT_ERR");}function B(a){if(ta(a,!0))throw new I("NO_MODIFICATION_ALLOWED_ERR");}function G(a,e){if(!a)throw new I(e);}function D(a){return ha&&z.isBrokenNode(a)|| !ba(ia,a.nodeType)&&!ma(a,!0)}function H(a,e){return e<=(u(a)?a.length:a.childNodes.length)}function qa(a){return!!a.startContainer&&!!a.endContainer&&!D(a.startContainer)&&!D(a.endContainer)&&H(a.startContainer,a.startOffset)&&H(a.endContainer,a.endOffset)}function E(a){if(!qa(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function F(a,e){E(a);var d=a.startContainer,b=a.startOffset,f=a.endContainer,h=a.endOffset,g=d===f;u(f)&&0<h&&h<f.length&&ga(f,h, e);u(d)&&0<b&&b<d.length&&(d=ga(d,b,e),g?(h-=b,f=d):f==d.parentNode&&h>=O(d)&&h++,b=0);a.setStartAndEnd(d,b,f,h)}function N(a){E(a);var e=a.commonAncestorContainer.parentNode.cloneNode(!1);e.appendChild(a.cloneContents());return e.innerHTML}function T(a){a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.NODE_BEFORE=0;a.NODE_AFTER=1;a.NODE_BEFORE_AND_AFTER=2;a.NODE_INSIDE=3}function M(a){T(a);T(a.prototype)}function L(a,e){return function(){E(this);var d=this.startContainer,b=this.startOffset, f=this.commonAncestorContainer,g=new x(this,!0);d!==f&&(d=aa(d,f,!0),b=h(d),d=b.node,b=b.offset);n(g,B);g.reset();f=a(g);g.detach();e(this,d,b,d,b);return f}}function K(e,b){function g(a,e){return function(d){A(d,da);A(R(d),ia);d=(a?f:h)(d);(e?k:l)(this,d.node,d.offset)}}function k(a,e,d){var f=a.endContainer,h=a.endOffset;if(e!==a.startContainer||d!==a.startOffset){if(R(e)!=R(f)||1==C(e,d,f,h))f=e,h=d;b(a,e,d,f,h)}}function l(a,e,d){var f=a.startContainer,h=a.startOffset;if(e!==a.endContainer||d!== a.endOffset){if(R(e)!=R(f)||-1==C(e,d,f,h))f=e,h=d;b(a,f,h,e,d)}}var n=function(){};n.prototype=a.rangePrototype;e.prototype=new n;S.extend(e.prototype,{setStart:function(a,e){t(a,!0);y(a,e);k(this,a,e)},setEnd:function(a,e){t(a,!0);y(a,e);l(this,a,e)},setStartAndEnd:function(){var a=arguments,e=a[0],d=a[1],f=e,h=d;switch(a.length){case 3:h=a[2];break;case 4:f=a[2],h=a[3]}b(this,e,d,f,h)},setBoundary:function(a,e,d){this["set"+(d?"Start":"End")](a,e)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0), setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){E(this);a?b(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):b(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){t(a,!0);b(this,a,0,a,P(a))},selectNode:function(a){t(a,!1);A(a,da);var e=f(a);a=h(a);b(this,e.node,e.offset,a.node,a.offset)},extractContents:L(m,b),deleteContents:L(p,b),canSurroundContents:function(){E(this);B(this.startContainer);B(this.endContainer); var a=new x(this,!0),e=a._first&&d(a._first,this)||a._last&&d(a._last,this);a.detach();return!e},splitBoundaries:function(){F(this)},splitBoundariesPreservingPositions:function(a){F(this,a)},normalizeBoundaries:function(){E(this);var a=this.startContainer,e=this.startOffset,d=this.endContainer,f=this.endOffset,h=function(a){var e=a.nextSibling;e&&e.nodeType==a.nodeType&&(d=a,f=a.length,a.appendData(e.data),e.parentNode.removeChild(e))},g=function(b){var h=b.previousSibling;if(h&&h.nodeType==b.nodeType){a= b;var g=b.length;e=h.length;b.insertData(0,h.data);h.parentNode.removeChild(h);a==d?(f+=e,d=a):d==b.parentNode&&(h=O(b),f==h?(d=b,f=g):f>h&&f--)}},k=!0;u(d)?d.length==f&&h(d):(0<f&&(k=d.childNodes[f-1])&&u(k)&&h(k),k=!this.collapsed);k?u(a)?0==e&&g(a):e<a.childNodes.length&&(h=a.childNodes[e])&&u(h)&&g(h):(a=d,e=f);b(this,a,e,d,f)},collapseToPoint:function(a,e){t(a,!0);y(a,e);this.setStartAndEnd(a,e)}});M(e)}function Q(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset; a.commonAncestorContainer=a.collapsed?a.startContainer:z.getCommonAncestor(a.startContainer,a.endContainer)}function V(a,e,d,b,f){a.startContainer=e;a.startOffset=d;a.endContainer=b;a.endOffset=f;a.document=z.getDocument(e);Q(a)}function W(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.document=a;Q(this)}var z=a.dom,S=a.util,Z=z.DomPosition,I=a.DOMException,u=z.isCharacterDataNode,O=z.getNodeIndex,U=z.isOrIsAncestorOf,ca=z.getDocument,C=z.comparePoints,ga=z.splitDataNode, aa=z.getClosestAncestorIn,P=z.getNodeLength,ba=z.arrayContains,R=z.getRootContainer,ha=a.features.crashyTextNodes;x.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,u(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length- this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,e,d;!u(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(e=a===this.sc?this.so:0,d=a===this.ec?this.eo:a.length,e!=d&&a.deleteData(e,d-e))},isPartiallySelectedSubtree:function(){return d(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new W(b(this.range)); var e=this._current,d=e,f=0,h=e,g=P(e);U(e,this.sc)&&(d=this.sc,f=this.so);U(e,this.ec)&&(h=this.ec,g=this.eo);V(a,d,f,h,g)}return new x(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var da=[1,3,4,5,7,8,10],ia=[2,9,11],ea=[1,3,4,5,7,8,10,11],ua=[1,3,4,5,7,8],ma=v([9,11]),ta=v([5,6,10,12]),sa=v([6,10,12]),ra=document.createElement("style"),na=!1;try{ra.innerHTML="<b>x</b>",na=3==ra.firstChild.nodeType}catch(wa){}a.features.htmlParsingConforms= na;var oa="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" ");S.extend(a.rangePrototype,{compareBoundaryPoints:function(a,e){E(this);w(this.startContainer,e.startContainer);var d=3==a||0==a?"start":"end",b=1==a||0==a?"start":"end";return C(this[d+"Container"],this[d+"Offset"],e[b+"Container"],e[b+"Offset"])},insertNode:function(a){E(this);A(a,ea);B(this.startContainer);if(U(a,this.startContainer))throw new I("HIERARCHY_REQUEST_ERR");a=g(a,this.startContainer, this.startOffset);this.setStartBefore(a)},cloneContents:function(){E(this);var a,e;if(this.collapsed)return b(this).createDocumentFragment();if(this.startContainer===this.endContainer&&u(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),e=b(this).createDocumentFragment(),e.appendChild(a),e;e=new x(this,!0);a=l(e);e.detach();return a},canSurroundContents:function(){E(this);B(this.startContainer);B(this.endContainer);var a=new x(this, !0),e=a._first&&d(a._first,this)||a._last&&d(a._last,this);a.detach();return!e},surroundContents:function(a){A(a,ua);if(!this.canSurroundContents())throw new I("INVALID_STATE_ERR");var e=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset);a.appendChild(e);this.selectNode(a)},cloneRange:function(){E(this);for(var a=new W(b(this)),e=oa.length,d;e--;)d=oa[e],a[d]=this[d];return a},toString:function(){E(this);var a=this.startContainer; if(a===this.endContainer&&u(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var e=[],a=new x(this,!0);n(a,function(a){3!=a.nodeType&&4!=a.nodeType||e.push(a.data)});a.detach();return e.join("")},compareNode:function(a){E(this);var e=a.parentNode,d=O(a);if(!e)throw new I("NOT_FOUND_ERR");a=this.comparePoint(e,d);e=this.comparePoint(e,d+1);return 0>a?0<e?2:0:0<e?1:3},comparePoint:function(a,e){E(this);G(a,"HIERARCHY_REQUEST_ERR");w(a,this.startContainer);return 0> C(a,e,this.startContainer,this.startOffset)?-1:0<C(a,e,this.endContainer,this.endOffset)?1:0},createContextualFragment:na?function(a){var e=this.startContainer,d=ca(e);if(!e)throw new I("INVALID_STATE_ERR");var b=null;1==e.nodeType?b=e:u(e)&&(b=z.parentElement(e));b=null===b||"HTML"==b.nodeName&&z.isHtmlNamespace(ca(b).documentElement)&&z.isHtmlNamespace(b)?d.createElement("body"):b.cloneNode(!1);b.innerHTML=a;return z.fragmentFromNodeChildren(b)}:function(a){var e=b(this).createElement("body");e.innerHTML= a;return z.fragmentFromNodeChildren(e)},toHtml:function(){return N(this)},intersectsNode:function(a,e){E(this);G(a,"NOT_FOUND_ERR");if(ca(a)!==b(this))return!1;var d=a.parentNode,f=O(a);G(d,"NOT_FOUND_ERR");var h=C(d,f,this.endContainer,this.endOffset),d=C(d,f+1,this.startContainer,this.startOffset);return e?0>=h&&0<=d:0>h&&0<d},isPointInRange:function(a,e){E(this);G(a,"HIERARCHY_REQUEST_ERR");w(a,this.startContainer);return 0<=C(a,e,this.startContainer,this.startOffset)&&0>=C(a,e,this.endContainer, this.endOffset)},intersectsRange:function(a){return k(this,a,!1)},intersectsOrTouchesRange:function(a){return k(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var e=C(this.startContainer,this.startOffset,a.startContainer,a.startOffset),d=C(this.endContainer,this.endOffset,a.endContainer,a.endOffset),b=this.cloneRange();-1==e&&b.setStart(a.startContainer,a.startOffset);1==d&&b.setEnd(a.endContainer,a.endOffset);return b}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var e= this.cloneRange();-1==C(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&e.setStart(a.startContainer,a.startOffset);1==C(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&e.setEnd(a.endContainer,a.endOffset);return e}throw new I("Ranges do not intersect");},containsNode:function(a,e){return e?this.intersectsNode(a,!1):3==this.compareNode(a)},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,P(a))},containsRange:function(a){var e= this.intersection(a);return null!==e&&a.equals(e)},containsNodeText:function(a){var e=this.cloneRange();e.selectNode(a);var d=e.getNodes([3]);return 0<d.length?(e.setStart(d[0],0),a=d.pop(),e.setEnd(a,a.length),this.containsRange(e)):this.containsNodeContents(a)},getNodes:function(a,e){E(this);return q(this,a,e)},getDocument:function(){return b(this)},collapseBefore:function(a){this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a);this.collapse(!0)},getBookmark:function(e){var d= b(this),f=a.createRange(d);e=e||z.getBody(d);f.selectNodeContents(e);var d=this.intersection(f),h=0,g=0;d&&(f.setEnd(d.startContainer,d.startOffset),h=f.toString().length,g=h+d.toString().length);return{start:h,end:g,containerNode:e}},moveToBookmark:function(a){var e=a.containerNode,d=0;this.setStart(e,0);this.collapse(!0);for(var e=[e],b,f=!1,h=!1,g,k;!h&&(b=e.pop());)if(3==b.nodeType)g=d+b.length,!f&&a.start>=d&&a.start<=g&&(this.setStart(b,a.start-d),f=!0),f&&a.end>=d&&a.end<=g&&(this.setEnd(b, a.end-d),h=!0),d=g;else for(k=b.childNodes,g=k.length;g--;)e.push(k[g])},getName:function(){return"DomRange"},equals:function(a){return W.rangesEqual(this,a)},isValid:function(){return qa(this)},inspect:function(){return r(this)},detach:function(){}});K(W,V);S.extend(W,{rangeProperties:oa,RangeIterator:x,copyComparisonConstants:M,createPrototypeRange:K,inspect:r,toHtml:N,getRangeDocument:b,rangesEqual:function(a,e){return a.startContainer===e.startContainer&&a.startOffset===e.startOffset&&a.endContainer=== e.endContainer&&a.endOffset===e.endOffset}});a.DomRange=W});y.createCoreModule("WrappedRange",["DomRange"],function(a,e){var d,b,f=a.dom,h=a.util,g=f.DomPosition,k=a.DomRange,l=f.getBody,n=f.getContentDocument,p=f.isCharacterDataNode;a.features.implementsDomRange&&function(){function b(a){for(var e=p.length,d;e--;)d=p[e],a[d]=a.nativeRange[d];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}var g,p=k.rangeProperties,m;d=function(a){if(!a)throw e.createError("WrappedRange: Range must be specified"); this.nativeRange=a;b(this)};k.createPrototypeRange(d,function(a,e,d,b,f){var h=a.startContainer!==e||a.startOffset!=d,g=a.endContainer!==b||a.endOffset!=f,k=!a.equals(a.nativeRange);if(h||g||k)a.setEnd(b,f),a.setStart(e,d)});g=d.prototype;g.selectNode=function(a){this.nativeRange.selectNode(a);b(this)};g.cloneContents=function(){return this.nativeRange.cloneContents()};g.surroundContents=function(a){this.nativeRange.surroundContents(a);b(this)};g.collapse=function(a){this.nativeRange.collapse(a); b(this)};g.cloneRange=function(){return new d(this.nativeRange.cloneRange())};g.refresh=function(){b(this)};g.toString=function(){return this.nativeRange.toString()};var q=document.createTextNode("test");l(document).appendChild(q);var r=document.createRange();r.setStart(q,0);r.setEnd(q,0);try{r.setStart(q,1),g.setStart=function(a,e){this.nativeRange.setStart(a,e);b(this)},g.setEnd=function(a,e){this.nativeRange.setEnd(a,e);b(this)},m=function(a){return function(e){this.nativeRange[a](e);b(this)}}}catch(x){g.setStart= function(a,e){try{this.nativeRange.setStart(a,e)}catch(d){this.nativeRange.setEnd(a,e),this.nativeRange.setStart(a,e)}b(this)},g.setEnd=function(a,e){try{this.nativeRange.setEnd(a,e)}catch(d){this.nativeRange.setStart(a,e),this.nativeRange.setEnd(a,e)}b(this)},m=function(a,e){return function(d){try{this.nativeRange[a](d)}catch(f){this.nativeRange[e](d),this.nativeRange[a](d)}b(this)}}}g.setStartBefore=m("setStartBefore","setEndBefore");g.setStartAfter=m("setStartAfter","setEndAfter");g.setEndBefore= m("setEndBefore","setStartBefore");g.setEndAfter=m("setEndAfter","setStartAfter");g.selectNodeContents=function(a){this.setStartAndEnd(a,0,f.getNodeLength(a))};r.selectNodeContents(q);r.setEnd(q,3);m=document.createRange();m.selectNodeContents(q);m.setEnd(q,4);m.setStart(q,2);-1==r.compareBoundaryPoints(r.START_TO_END,m)&&1==r.compareBoundaryPoints(r.END_TO_START,m)?g.compareBoundaryPoints=function(a,e){e=e.nativeRange||e;a==e.START_TO_END?a=e.END_TO_START:a==e.END_TO_START&&(a=e.START_TO_END);return this.nativeRange.compareBoundaryPoints(a, e)}:g.compareBoundaryPoints=function(a,e){return this.nativeRange.compareBoundaryPoints(a,e.nativeRange||e)};m=document.createElement("div");m.innerHTML="123";var t=m.firstChild,v=l(document);v.appendChild(m);r.setStart(t,1);r.setEnd(t,2);r.deleteContents();"13"==t.data&&(g.deleteContents=function(){this.nativeRange.deleteContents();b(this)},g.extractContents=function(){var a=this.nativeRange.extractContents();b(this);return a});v.removeChild(m);v=null;h.isHostMethod(r,"createContextualFragment")&& (g.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});l(document).removeChild(q);g.getName=function(){return"WrappedRange"};a.WrappedRange=d;a.createNativeRange=function(a){a=n(a,e,"createNativeRange");return a.createRange()}}();if(a.features.implementsTextRange){var m=function(a,e,d,b,h){var k=a.duplicate();k.collapse(d);var l=k.parentElement();f.isOrIsAncestorOf(e,l)||(l=e);if(!l.canHaveHTML)return l=new g(l.parentNode,f.getNodeIndex(l)),{boundaryPosition:l, nodeInfo:{nodeIndex:l.offset,containerElement:l.node}};e=f.getDocument(l).createElement("span");e.parentNode&&e.parentNode.removeChild(e);var n,m=d?"StartToStart":"StartToEnd",q=h&&h.containerElement==l?h.nodeIndex:0,r=l.childNodes.length,x=r;for(h=x;;){h==r?l.appendChild(e):l.insertBefore(e,l.childNodes[h]);k.moveToElementText(e);n=k.compareEndPoints(m,a);if(0==n||q==x)break;else if(-1==n)if(x==q+1)break;else q=h;else x=x==q+1?q:h;h=Math.floor((q+x)/2);l.removeChild(e)}m=e.nextSibling;if(-1==n&& m&&p(m)){k.setEndPoint(d?"EndToStart":"EndToEnd",a);if(/[\r\n]/.test(m.data))for(d=k.duplicate(),b=d.text.replace(/\r\n/g,"\r").length,b=d.moveStart("character",b);-1==d.compareEndPoints("StartToEnd",d);)b++,d.moveStart("character",1);else b=k.text.length;d=new g(m,b)}else a=(b||!d)&&e.previousSibling,d=(d=(b||d)&&e.nextSibling)&&p(d)?new g(d,0):a&&p(a)?new g(a,a.data.length):new g(l,f.getNodeIndex(e));e.parentNode.removeChild(e);return{boundaryPosition:d,nodeInfo:{nodeIndex:h,containerElement:l}}}, q=function(a,e){var d,b,h=a.offset,g=f.getDocument(a.node),k=l(g).createTextRange(),n=p(a.node);n?(d=a.node,b=d.parentNode):(d=a.node.childNodes,d=h<d.length?d[h]:null,b=a.node);g=g.createElement("span");g.innerHTML="&#feff;";d?b.insertBefore(g,d):b.appendChild(g);k.moveToElementText(g);k.collapse(!e);b.removeChild(g);if(n)k[e?"moveStart":"moveEnd"]("character",h);return k};b=function(a){this.textRange=a;this.refresh()};b.prototype=new k(document);b.prototype.refresh=function(){var a,e,d;d=this.textRange; a=d.parentElement();var b=d.duplicate();b.collapse(!0);e=b.parentElement();b=d.duplicate();b.collapse(!1);d=b.parentElement();e=e==d?e:f.getCommonAncestor(e,d);e=e==a?e:f.getCommonAncestor(a,e);a=this.textRange;0==a.compareEndPoints("StartToEnd",a)?e=a=m(this.textRange,e,!0,!0).boundaryPosition:(d=m(this.textRange,e,!0,!1),a=d.boundaryPosition,e=m(this.textRange,e,!1,!1,d.nodeInfo).boundaryPosition);this.setStart(a.node,a.offset);this.setEnd(e.node,e.offset)};b.prototype.getName=function(){return"WrappedTextRange"}; k.copyComparisonConstants(b);var r=function(a){if(a.collapsed)return q(new g(a.startContainer,a.startOffset),!0);var e=q(new g(a.startContainer,a.startOffset),!0),d=q(new g(a.endContainer,a.endOffset),!1);a=l(k.getRangeDocument(a)).createTextRange();a.setEndPoint("StartToStart",e);a.setEndPoint("EndToEnd",d);return a};b.rangeToTextRange=r;b.prototype.toTextRange=function(){return r(this)};a.WrappedTextRange=b;if(!a.features.implementsDomRange||a.config.preferTextRange){var x=Function("return this;")(); "undefined"==typeof x.Range&&(x.Range=b);a.createNativeRange=function(a){a=n(a,e,"createNativeRange");return l(a).createTextRange()};a.WrappedRange=b}}a.createRange=function(d){d=n(d,e,"createRange");return new a.WrappedRange(a.createNativeRange(d))};a.createRangyRange=function(a){a=n(a,e,"createRangyRange");return new k(a)};a.createIframeRange=function(d){e.deprecationNotice("createIframeRange()","createRange(iframeEl)");return a.createRange(d)};a.createIframeRangyRange=function(d){e.deprecationNotice("createIframeRangyRange()", "createRangyRange(iframeEl)");return a.createRangyRange(d)};a.addShimListener(function(e){var d=e.document;"undefined"==typeof d.createRange&&(d.createRange=function(){return a.createRange(d)});d=e=null})});y.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,e){function d(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function b(a,d){if(a){if(D.isWindow(a))return a;if(a instanceof t)return a.win;var f=D.getContentDocument(a,e,d);return D.getWindow(f)}return window} function f(a){return b(a,"getWinSelection").getSelection()}function h(a){return b(a,"getDocSelection").document.selection}function g(a){var e=!1;a.anchorNode&&(e=1==D.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return e}function k(a,e,d){var b=d?"end":"start";d=d?"start":"end";a.anchorNode=e[b+"Container"];a.anchorOffset=e[b+"Offset"];a.focusNode=e[d+"Container"];a.focusOffset=e[d+"Offset"]}function l(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount= 0;a.isCollapsed=!0;a._ranges.length=0}function n(e){var d;e instanceof N?(d=a.createNativeRange(e.getDocument()),d.setEnd(e.endContainer,e.endOffset),d.setStart(e.startContainer,e.startOffset)):e instanceof T?d=e.nativeRange:K.implementsDomRange&&e instanceof D.getWindow(e.startContainer).Range&&(d=e);return d}function p(a){var d=a.getNodes(),b;a:if(d.length&&1==d[0].nodeType){b=1;for(var f=d.length;b<f;++b)if(!D.isAncestorOf(d[0],d[b])){b=!1;break a}b=!0}else b=!1;if(!b)throw e.createError("getSingleElementFromRange: range "+ a.inspect()+" did not consist of a single element");return d[0]}function m(a){return!!a&&"undefined"!=typeof a.text}function q(a,e){var d=new T(e);a._ranges=[d];k(a,d,!1);a.rangeCount=1;a.isCollapsed=d.collapsed}function r(e){e._ranges.length=0;if("None"==e.docSelection.type)l(e);else{var d=e.docSelection.createRange();if(m(d))q(e,d);else{e.rangeCount=d.length;for(var b,f=Q(d.item(0)),h=0;h<e.rangeCount;++h)b=a.createRange(f),b.selectNode(d.item(h)),e._ranges.push(b);e.isCollapsed=1==e.rangeCount&& e._ranges[0].collapsed;k(e,e._ranges[e.rangeCount-1],!1)}}}function x(a,d){for(var b=a.docSelection.createRange(),f=p(d),h=Q(b.item(0)),h=V(h).createControlRange(),g=0,k=b.length;g<k;++g)h.add(b.item(g));try{h.add(f)}catch(l){throw e.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}h.select();r(a)}function t(a,e,d){this.nativeSelection=a;this.docSelection=e;this._ranges=[];this.win=d;this.refresh()}function v(a){a.win=a.anchorNode= a.focusNode=a._ranges=null;a.rangeCount=a.anchorOffset=a.focusOffset=0;a.detached=!0}function A(a,e){for(var d=R.length,b,f;d--;)if(b=R[d],f=b.selection,"deleteAll"==e)v(f);else if(b.win==a)return"delete"==e?(R.splice(d,1),!0):f;"deleteAll"==e&&(R.length=0);return null}function y(a,d){for(var b=Q(d[0].startContainer),b=V(b).createControlRange(),f=0,h,g=d.length;f<g;++f){h=p(d[f]);try{b.add(h)}catch(k){throw e.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)"); }}b.select();r(a)}function w(a,e){if(a.win.document!=Q(e))throw new M("WRONG_DOCUMENT_ERR");}function B(e){return function(d,b){var f;this.rangeCount?(f=this.getRangeAt(0),f["set"+(e?"Start":"End")](d,b)):(f=a.createRange(this.win.document),f.setStartAndEnd(d,b));this.setSingleRange(f,this.isBackward())}}function G(a){var e=[],d=new L(a.anchorNode,a.anchorOffset),b=new L(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var h= 0,g=a.rangeCount;h<g;++h)e[h]=N.inspect(a.getRangeAt(h));return"["+f+"(Ranges: "+e.join(", ")+")(anchor: "+d.inspect()+", focus: "+b.inspect()+"]"}a.config.checkSelectionRanges=!0;var D=a.dom,H=a.util,F=H.isHostMethod,N=a.DomRange,T=a.WrappedRange,M=a.DOMException,L=D.DomPosition,ja,la,K=a.features,Q=D.getDocument,V=D.getBody,W=N.rangesEqual,z=F(window,"getSelection"),S=H.isHostObject(document,"selection");K.implementsWinGetSelection=z;var Z=(K.implementsDocSelection=S)&&(!z||a.config.preferTextRange); Z?(ja=h,a.isSelectionValid=function(a){a=b(a,"isSelectionValid").document;var e=a.selection;return"None"!=e.type||Q(e.createRange().parentElement())==a}):z?(ja=f,a.isSelectionValid=function(){return!0}):e.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=ja;var z=ja(),I=a.createNativeRange(document),u=V(document),O=H.areHostProperties(z,["anchorNode","focusNode","anchorOffset","focusOffset"]);K.selectionHasAnchorAndFocus=O;var U=F(z,"extend");K.selectionHasExtend= U;var ca="number"==typeof z.rangeCount;K.selectionHasRangeCount=ca;var C=!1,ga=!0,aa=U?function(e,d){var b=N.getRangeDocument(d),b=a.createRange(b);b.collapseToPoint(d.endContainer,d.endOffset);e.addRange(n(b));e.extend(d.startContainer,d.startOffset)}:null;H.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof z.rangeCount&&K.implementsDomRange&&function(){var e=window.getSelection();if(e){for(var d=e.rangeCount,b=1<d,f=[],h=g(e),k=0;k<d;++k)f[k]=e.getRangeAt(k);var k= V(document),l=k.appendChild(document.createElement("div"));l.contentEditable="false";var n=l.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),p=document.createRange();p.setStart(n,1);p.collapse(!0);e.addRange(p);ga=1==e.rangeCount;e.removeAllRanges();b||((b=window.navigator.appVersion.match(/Chrome\/(.*?) /))&&36<=parseInt(b[1])?C=!1:(b=p.cloneRange(),p.setStart(n,0),b.setEnd(n,3),b.setStart(n,2),e.addRange(p),e.addRange(b),C=2==e.rangeCount));k.removeChild(l);e.removeAllRanges();for(k= 0;k<d;++k)0==k&&h?aa?aa(e,f[k]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(f[k])):e.addRange(f[k])}}();K.selectionSupportsMultipleRanges=C;K.collapsedNonEditableSelectionsSupported=ga;var P=!1;u&&F(u,"createControlRange")&&(u=u.createControlRange(),H.areHostProperties(u,["item","add"])&&(P=!0));K.implementsControlRange=P;la=O?function(a){return a.anchorNode===a.focusNode&& a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ba;F(z,"getRangeAt")?ba=function(a,e){try{return a.getRangeAt(e)}catch(d){return null}}:O&&(ba=function(e){var d=Q(e.anchorNode),d=a.createRange(d);d.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset);d.collapsed!==this.isCollapsed&&d.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset);return d});t.prototype=a.selectionPrototype;var R=[],ha=function(a){if(a&& a instanceof t)return a.refresh(),a;a=b(a,"getNativeSelection");var e=A(a),d=ja(a),f=S?h(a):null;e?(e.nativeSelection=d,e.docSelection=f,e.refresh()):(e=new t(d,f,a),R.push({win:a,selection:e}));return e};a.getSelection=ha;a.getIframeSelection=function(d){e.deprecationNotice("getIframeSelection()","getSelection(iframeEl)");return a.getSelection(D.getIframeWindow(d))};u=t.prototype;if(!Z&&O&&H.areHostMethods(z,["removeAllRanges","addRange"]))u.removeAllRanges=function(){this.nativeSelection.removeAllRanges(); l(this)},u.addRange=ca?function(e,b){if(P&&S&&"Control"==this.docSelection.type)x(this,e);else if(d(b)&&U)aa(this.nativeSelection,e),this.refresh();else{var f;C?f=this.rangeCount:(this.removeAllRanges(),f=0);var h=n(e).cloneRange();try{this.nativeSelection.addRange(h)}catch(g){}this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==f+1?(a.config.checkSelectionRanges&&(f=ba(this.nativeSelection,this.rangeCount-1))&&!W(f,e)&&(e=new T(f)),this._ranges[this.rangeCount-1]=e,k(this,e,ea(this.nativeSelection)), this.isCollapsed=la(this)):this.refresh()}}:function(a,e){d(e)&&U?aa(this.nativeSelection,a):this.nativeSelection.addRange(n(a));this.refresh()},u.setRanges=function(a){if(P&&S&&1<a.length)y(this,a);else{this.removeAllRanges();for(var e=0,d=a.length;e<d;++e)this.addRange(a[e])}};else if(F(z,"empty")&&F(I,"select")&&P&&Z)u.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=Q(this.anchorNode);else if("Control"==this.docSelection.type){var e= this.docSelection.createRange();e.length&&(a=Q(e.item(0)))}a&&(V(a).createTextRange().select(),this.docSelection.empty())}}catch(d){}l(this)},u.addRange=function(e){"Control"==this.docSelection.type?x(this,e):(a.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,k(this,e,!1))},u.setRanges=function(a){this.removeAllRanges();var e=a.length;1<e?y(this,a):e&&this.addRange(a[0])};else return e.fail("No means of selecting a Range or TextRange was found"), !1;u.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new M("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var da;if(Z)da=function(e){var d;a.isSelectionValid(e.win)?d=e.docSelection.createRange():(d=V(e.win.document).createTextRange(),d.collapse(!0));"Control"==e.docSelection.type?r(e):m(d)?q(e,d):l(e)};else if(F(z,"getRangeAt")&&"number"==typeof z.rangeCount)da=function(e){if(P&&S&&"Control"==e.docSelection.type)r(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount, e.rangeCount){for(var d=0,b=e.rangeCount;d<b;++d)e._ranges[d]=new a.WrappedRange(e.nativeSelection.getRangeAt(d));k(e,e._ranges[e.rangeCount-1],ea(e.nativeSelection));e.isCollapsed=la(e)}else l(e)};else if(O&&"boolean"==typeof z.isCollapsed&&"boolean"==typeof I.collapsed&&K.implementsDomRange)da=function(a){var e;e=a.nativeSelection;e.anchorNode?(e=ba(e,0),a._ranges=[e],a.rangeCount=1,e=a.nativeSelection,a.anchorNode=e.anchorNode,a.anchorOffset=e.anchorOffset,a.focusNode=e.focusNode,a.focusOffset= e.focusOffset,a.isCollapsed=la(a)):l(a)};else return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;u.refresh=function(a){var e=a?this._ranges.slice(0):null,d=this.anchorNode,b=this.anchorOffset;da(this);if(a){a=e.length;if(a!=this._ranges.length||this.anchorNode!=d||this.anchorOffset!=b)return!0;for(;a--;)if(!W(e[a],this._ranges[a]))return!0;return!1}};var ia=function(a,e){var d=a.getAllRanges();a.removeAllRanges();for(var b=0,f=d.length;b<f;++b)W(e,d[b])|| a.addRange(d[b]);a.rangeCount||l(a)};u.removeRange=P&&S?function(a){if("Control"==this.docSelection.type){var e=this.docSelection.createRange();a=p(a);for(var d=Q(e.item(0)),d=V(d).createControlRange(),b,f=!1,h=0,g=e.length;h<g;++h)b=e.item(h),b!==a||f?d.add(e.item(h)):f=!0;d.select();r(this)}else ia(this,a)}:function(a){ia(this,a)};var ea;!Z&&O&&K.implementsDomRange?(ea=g,u.isBackward=function(){return ea(this)}):ea=u.isBackward=function(){return!1};u.isBackwards=u.isBackward;u.toString=function(){for(var a= [],e=0,d=this.rangeCount;e<d;++e)a[e]=""+this._ranges[e];return a.join("")};u.collapse=function(e,d){w(this,e);var b=a.createRange(e);b.collapseToPoint(e,d);this.setSingleRange(b);this.isCollapsed=!0};u.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new M("INVALID_STATE_ERR");};u.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new M("INVALID_STATE_ERR"); };u.selectAllChildren=function(e){w(this,e);var d=a.createRange(e);d.selectNodeContents(e);this.setSingleRange(d)};u.deleteFromDocument=function(){if(P&&S&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),e;a.length;)e=a.item(0),a.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount&&(a=this.getAllRanges(),a.length)){this.removeAllRanges();e=0;for(var d=a.length;e<d;++e)a[e].deleteContents();this.addRange(a[d-1])}};u.eachRange=function(a,e){for(var d= 0,b=this._ranges.length;d<b;++d)if(a(this.getRangeAt(d)))return e};u.getAllRanges=function(){var a=[];this.eachRange(function(e){a.push(e)});return a};u.setSingleRange=function(a,e){this.removeAllRanges();this.addRange(a,e)};u.callMethodOnEachRange=function(a,e){var d=[];this.eachRange(function(b){d.push(b[a].apply(b,e))});return d};u.setStart=B(!0);u.setEnd=B(!1);a.rangePrototype.select=function(a){ha(this.getDocument()).setSingleRange(this,a)};u.changeEachRange=function(a){var e=[],d=this.isBackward(); this.eachRange(function(d){a(d);e.push(d)});this.removeAllRanges();d&&1==e.length?this.addRange(e[0],"backward"):this.setRanges(e)};u.containsNode=function(a,e){return this.eachRange(function(d){return d.containsNode(a,e)},!0)||!1};u.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}};u.moveToBookmark=function(e){for(var d=[],b=0,f,h;f=e.rangeBookmarks[b++];)h=a.createRange(this.win),h.moveToBookmark(f),d.push(h);e.backward?this.setSingleRange(d[0], "backward"):this.setRanges(d)};u.toHtml=function(){var a=[];this.eachRange(function(e){a.push(N.toHtml(e))});return a.join("")};K.implementsTextRange&&(u.getNativeTextRange=function(){var d;if(d=this.docSelection){d=d.createRange();if(m(d))return d;throw e.createError("getNativeTextRange: selection is a control selection");}if(0<this.rangeCount)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw e.createError("getNativeTextRange: selection contains no range");});u.getName=function(){return"WrappedSelection"}; u.inspect=function(){return G(this)};u.detach=function(){A(this.win,"delete");v(this)};t.detachAll=function(){A(null,"deleteAll")};t.inspect=G;t.isDirectionBackward=d;a.Selection=t;a.selectionPrototype=u;a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ha(a)});a=null})});var L=!1,B=function(a){L||(L=!0,!y.initialized&&y.config.autoInitialize&&l())};A&&("complete"==document.readyState?B():(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded", B,!1),N(window,"load",B)));return y},this); (function(a,f){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof exports?module.exports=a(require("rangy")):a(f.rangy)})(function(a){a.createModule("SaveRestore",["WrappedRange"],function(a,b){function g(a,e){var d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),b,f=n.getDocument(a.startContainer),h=a.cloneRange();h.collapse(e);b=f.createElement("span");b.id=d;b.style.lineHeight="0";b.style.display="none";b.className="rangySelectionBoundary"; b.appendChild(f.createTextNode("\ufeff"));h.insertNode(b);return b}function d(a,e,d,f){(a=(a||document).getElementById(d))?(e[f?"setStartBefore":"setEndBefore"](a),a.parentNode.removeChild(a)):b.warn("Marker element has been removed. Cannot restore selection.")}function k(a,e){return e.compareBoundaryPoints(a.START_TO_START,a)}function h(e,d){var b,h,k=a.DomRange.getRangeDocument(e),l=e.toString();if(e.collapsed)return h=g(e,!1),{document:k,markerId:h.id,collapsed:!0};h=g(e,!1);b=g(e,!0);return{document:k, startMarkerId:b.id,endMarkerId:h.id,collapsed:!1,backward:d,toString:function(){return"original text: '"+l+"', new text: '"+e.toString()+"'"}}}function e(e,h){var g=e.document;"undefined"==typeof h&&(h=!0);var k=a.createRange(g);if(e.collapsed)if(g=(g||document).getElementById(e.markerId)){g.style.display="inline";var l=g.previousSibling;l&&3==l.nodeType?(g.parentNode.removeChild(g),k.collapseToPoint(l,l.length)):(k.collapseBefore(g),g.parentNode.removeChild(g))}else b.warn("Marker element has been removed. Cannot restore selection."); else d(g,k,e.startMarkerId,!0),d(g,k,e.endMarkerId,!1);h&&k.normalizeBoundaries();return k}function l(e,d){var b=[],g,l;e=e.slice(0);e.sort(k);var n=0;for(g=e.length;n<g;++n)b[n]=h(e[n],d);for(n=g-1;0<=n;--n)g=e[n],l=a.DomRange.getRangeDocument(g),g.collapsed?g.collapseAfter((l||document).getElementById(b[n].markerId)):(g.setEndBefore((l||document).getElementById(b[n].endMarkerId)),g.setStartAfter((l||document).getElementById(b[n].startMarkerId)));return b}function p(a){for(var d=[],b=a.length-1;0<= b;b--)d[b]=e(a[b],!0);return d}function m(a,e){var d=(a||document).getElementById(e);d&&d.parentNode.removeChild(d)}var n=a.dom;a.util.extend(a,{saveRange:h,restoreRange:e,saveRanges:l,restoreRanges:p,saveSelection:function(e){if(!a.isSelectionValid(e))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(e),h=d.getAllRanges(),g=1==h.length&&d.isBackward(),k=l(h,g);g?d.setSingleRange(h[0],"backward"): d.setRanges(h);return{win:e,rangeInfos:k,restored:!1}},restoreSelection:function(e,d){if(!e.restored){var b=e.rangeInfos,h=a.getSelection(e.win),g=p(b);1==b.length&&d&&a.features.selectionHasExtend&&b[0].backward?(h.removeAllRanges(),h.addRange(g[0],!0)):h.setRanges(g);e.restored=!0}},removeMarkerElement:m,removeMarkers:function(a){for(var e=a.rangeInfos,d=0,b=e.length,f;d<b;++d)f=e[d],f.collapsed?m(a.doc,f.markerId):(m(a.doc,f.startMarkerId),m(a.doc,f.endMarkerId))}})})},this);var Base=function(){}; Base.extend=function(a,f){var b=Base.prototype.extend;Base._prototyping=!0;var g=new this;b.call(g,a);g.base=function(){};delete Base._prototyping;var d=g.constructor,k=g.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==k)this._constructing=!0,d.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||b).call(arguments[0],g)};k.ancestor=this;k.extend=this.extend;k.forEach=this.forEach;k.implement=this.implement;k.prototype= g;k.toString=this.toString;k.valueOf=function(a){return"object"==a?k:d.valueOf()};b.call(k,f);"function"==typeof k.init&&k.init();return k}; Base.prototype={extend:function(a,f){if(1<arguments.length){var b=this[a];if(b&&"function"==typeof f&&(!b.valueOf||b.valueOf()!=f.valueOf())&&/\bbase\b/.test(f)){var g=f.valueOf();f=function(){var a=this.base||Base.prototype.base;this.base=b;var e=g.apply(this,arguments);this.base=a;return e};f.valueOf=function(a){return"object"==a?f:g};f.toString=Base.toString}this[a]=f}else if(a){var d=Base.prototype.extend;Base._prototyping||"function"==typeof this||(d=this.extend||d);for(var k={toSource:null}, h=["constructor","toString","valueOf"],e=Base._prototyping?0:1;l=h[e++];)a[l]!=k[l]&&d.call(this,l,a[l]);for(var l in a)k[l]||d.call(this,l,a[l])}return this}}; Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,f,b){for(var g in a)void 0===this.prototype[g]&&f.call(b,a[g],g,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}); wysihtml5.browser=function(){function a(a,d){var b=-1,f;"Microsoft Internet Explorer"==navigator.appName?f=/MSIE ([0-9]{1,}[.0-9]{0,})/:"Netscape"==navigator.appName&&(f=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/);f&&null!=f.exec(navigator.userAgent)&&(b=parseFloat(RegExp.$1));if(-1===b)return!1;if(!a)return!0;if(!d)return a===b;if("<"===d)return a<b;if(">"===d)return a>b;if("<="===d)return a<=b;if(">="===d)return a>=b}var f=navigator.userAgent,b=document.createElement("div"),g=-1!==f.indexOf("Gecko")&& -1===f.indexOf("KHTML"),d=-1!==f.indexOf("AppleWebKit/"),k=-1!==f.indexOf("Chrome/"),h=-1!==f.indexOf("Opera/");return{USER_AGENT:f,supported:function(){var a=this.USER_AGENT.toLowerCase(),d="contentEditable"in b,f=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,h=document.querySelector&&document.querySelectorAll,g;if(g=this.isIos())g=5>+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1];a=g||this.isAndroid()&&4>+(a.match(/android (\d+)/)|| [void 0,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return d&&f&&h&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return a()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return a()},hasCurrentStyleProperty:function(){return"currentStyle"in b},insertsLineBreaksOnReturn:function(){return g},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){var d;(d="on"+a in b)||(b.setAttribute("on"+a,"return;"),d="function"===typeof b["on"+a]);return d},supportsEventsInIframeCorrectly:function(){return!h},supportsHTML5Tags:function(a){a=a.createElement("div");a.innerHTML="<article>foo</article>";return"<article>foo</article>"===a.innerHTML.toLowerCase()},supportsCommand:function(){var e={formatBlock:a(10,"<="), insertUnorderedList:a(),insertOrderedList:a()},d={insertHTML:g};return function(a,b){if(!e[b]){try{return a.queryCommandSupported(b)}catch(f){}try{return a.queryCommandEnabled(b)}catch(h){return!!d[b]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return a()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return g||h||d},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")}, canSelectImagesInContentEditable:function(){return g||a()||h},autoScrollsToCaret:function(){return!d},autoClosesUnclosedTags:function(){var a=b.cloneNode(!1),d;a.innerHTML="<p><div></div>";a=a.innerHTML.toLowerCase();d="<p></p><div></div>"===a||"<p><div></div></p>"===a;this.autoClosesUnclosedTags=function(){return d};return d},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return h},supportsSpeechApiOn:function(a){return 11<=(f.match(/Chrome\/(\d+)/)||[void 0,0])[1]&&("onwebkitspeechchange"in a||"speech"in a)},crashesWhenDefineProperty:function(e){return a(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return a()},hasProblemsSettingCaretAfterImg:function(){return a()},hasUndoInContextMenu:function(){return g||k||h},hasInsertNodeIssue:function(){return h},hasIframeFocusIssue:function(){return a()}, createsNestedInvalidMarkupAfterPaste:function(){return d},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)},fixStyleKey:function(a){return"cssFloat"===a?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":a}}}(); wysihtml5.lang.array=function(a){return{contains:function(f){if(Array.isArray(f)){for(var b=f.length;b--;)if(-1!==wysihtml5.lang.array(a).indexOf(f[b]))return!0;return!1}return-1!==wysihtml5.lang.array(a).indexOf(f)},indexOf:function(f){if(a.indexOf)return a.indexOf(f);for(var b=0,g=a.length;b<g;b++)if(a[b]===f)return b;return-1},without:function(f){f=wysihtml5.lang.array(f);for(var b=[],g=0,d=a.length;g<d;g++)f.contains(a[g])||b.push(a[g]);return b},get:function(){for(var f=0,b=a.length,g=[];f<b;f++)g.push(a[f]); return g},map:function(f,b){if(Array.prototype.map)return a.map(f,b);for(var g=a.length>>>0,d=Array(g),k=0;k<g;k++)d[k]=f.call(b,a[k],k,a);return d},unique:function(){for(var f=[],b=a.length,g=0;g<b;)wysihtml5.lang.array(f).contains(a[g])||f.push(a[g]),g++;return f}}}; wysihtml5.lang.Dispatcher=Base.extend({on:function(a,f){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(f);return this},off:function(a,f){this.events=this.events||{};var b=0,g,d;if(a){g=this.events[a]||[];for(d=[];b<g.length;b++)g[b]!==f&&f&&d.push(g[b]);this.events[a]=d}else this.events={};return this},fire:function(a,f){this.events=this.events||{};for(var b=this.events[a]||[],g=0;g<b.length;g++)b[g].call(this,f);return this},observe:function(){return this.on.apply(this, arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}); wysihtml5.lang.object=function(a){return{merge:function(f){for(var b in f)a[b]=f[b];return this},get:function(){return a},clone:function(f){var b={},g;if(null===a||!wysihtml5.lang.object(a).isPlainObject())return a;for(g in a)a.hasOwnProperty(g)&&(b[g]=f?wysihtml5.lang.object(a[g]).clone(f):a[g]);return b},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return"[object Object]"=== Object.prototype.toString.call(a)}}}; (function(){var a=/^\s+/,f=/\s+$/,b=/[&<>\t"]/g,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml5.lang.string=function(d){d=String(d);return{trim:function(){return d.replace(a,"").replace(f,"")},interpolate:function(a){for(var b in a)d=this.replace("#{"+b+"}").by(a[b]);return d},replace:function(a){return{by:function(b){return d.split(a).join(b)}}},escapeHTML:function(a,f){var e=d.replace(b,function(a){return g[a]});a&&(e=e.replace(/(?:\r\n|\r|\n)/g,"<br />"));f&&(e=e.replace(/ /gi, "&nbsp; "));return e}}}})(); (function(a){function f(a){return a.replace(d,function(a,e){var d=(e.match(k)||[])[1]||"",b=h[d];e=e.replace(k,"");e.split(b).length>e.split(d).length&&(e+=d,d="");var f=b=e;100<e.length&&(f=f.substr(0,100)+"...");"www."===b.substr(0,4)&&(b="http://"+b);return'<a href="'+b+'">'+f+"</a>"+d})}function b(e,h){if(!(g.contains(e.nodeName)||e.className&&a.lang.array(e.className.split(" ")).contains(h)))if(e.nodeType===a.TEXT_NODE&&e.data.match(d)){var k=e.parentNode,m=a.lang.string(e.data).escapeHTML(),n; n=k.ownerDocument;var q=n._wysihtml5_tempElement;q||(q=n._wysihtml5_tempElement=n.createElement("div"));n=q;n.innerHTML="<span></span>"+f(m);for(n.removeChild(n.firstChild);n.firstChild;)k.insertBefore(n.firstChild,e);k.removeChild(e)}else{k=a.lang.array(e.childNodes).get();m=k.length;for(n=0;n<m;n++)b(k[n],h);return e}}var g=a.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),d=/((https?:\/\/|www\.)[^\s<]{3,})/gi,k=/([^\w\/\-](,?))$/i,h={")":"(","]":"[","}":"{"};a.dom.autoLink=function(e, d){var f;a:{f=e;for(var h;f.parentNode;){f=f.parentNode;h=f.nodeName;if(f.className&&a.lang.array(f.className.split(" ")).contains(d)||g.contains(h)){f=!0;break a}if("body"===h)break}f=!1}if(f)return e;e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body);return b(e,d)};a.dom.autoLink.URL_REG_EXP=d})(wysihtml5); (function(a){var f=a.dom;f.addClass=function(a,g){var d=a.classList;if(d)return d.add(g);f.hasClass(a,g)||(a.className+=" "+g)};f.removeClass=function(a,f){var d=a.classList;if(d)return d.remove(f);a.className=a.className.replace(new RegExp("(^|\\s+)"+f+"(\\s+|$)")," ")};f.hasClass=function(a,f){var d=a.classList;if(d)return d.contains(f);d=a.className;return 0<d.length&&(d==f||(new RegExp("(^|\\s)"+f+"(\\s|$)")).test(d))}})(wysihtml5); wysihtml5.dom.contains=function(){var a=document.documentElement;if(a.contains)return function(a,b){b.nodeType!==wysihtml5.ELEMENT_NODE&&(b=b.parentNode);return a!==b&&a.contains(b)};if(a.compareDocumentPosition)return function(a,b){return!!(a.compareDocumentPosition(b)&16)}}(); wysihtml5.dom.convertToList=function(){function a(a,b){var g=a.createElement("li");b.appendChild(g);return g}return function(f,b,g){if("UL"===f.nodeName||"OL"===f.nodeName||"MENU"===f.nodeName)return f;var d=f.ownerDocument;b=d.createElement(b);var k=f.querySelectorAll("br"),h=k.length,e,l,p,m,n;for(n=0;n<h;n++)for(l=k[n];(e=l.parentNode)&&e!==f&&e.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(e)){e.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}e=wysihtml5.lang.array(f.childNodes).get(); k=e.length;for(n=0;n<k;n++)m=m||a(d,b),h=e[n],l="block"===wysihtml5.dom.getStyle("display").from(h),p="BR"===h.nodeName,!l||g&&wysihtml5.dom.hasClass(h,g)?p?m=m.firstChild?null:m:m.appendChild(h):(m=m.firstChild?a(d,b):m,m.appendChild(h),m=null);0===e.length&&a(d,b);f.parentNode.replaceChild(b,f);return b}}();wysihtml5.dom.copyAttributes=function(a){return{from:function(f){return{to:function(b){for(var g,d=0,k=a.length;d<k;d++)g=a[d],"undefined"!==typeof f[g]&&""!==f[g]&&(b[g]=f[g]);return{andTo:arguments.callee}}}}}}; (function(a){var f=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],b=function(b){var d;a:{d=0;for(var k=f.length;d<k;d++)if("border-box"===a.getStyle(f[d]).from(b)){d=f[d];break a}d=void 0}return d?parseInt(a.getStyle("width").from(b),10)<b.offsetWidth:!1};a.copyStyles=function(g){return{from:function(d){b(d)&&(g=wysihtml5.lang.array(g).without(f));for(var k="",h=g.length,e=0,l;e<h;e++)l=g[e],k+=l+":"+a.getStyle(l).from(d)+";";return{to:function(e){a.setStyles(k).on(e);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom); (function(a){a.dom.delegate=function(a,b,g,d){var k=function(h){for(var e=h.target,e=3===e.nodeType?e.parentNode:e,g=a.querySelectorAll(b),k=0,m=g.length;k<m;k++)g[k].contains(e)&&d.call(g[k],h)};a.addEventListener(g,k,!1);return{stop:function(){a.removeEventListener(g,k,!1)}}}})(wysihtml5); (function(a){a.dom.domNode=function(f){var b=[a.ELEMENT_NODE,a.TEXT_NODE];return{prev:function(g){var d=f.previousSibling;return d?!a.lang.array(g&&g.nodeTypes?g.nodeTypes:b).contains(d.nodeType)||g&&g.ignoreBlankTexts&&d.nodeType===a.TEXT_NODE&&/^\s*$/g.test(d.data)?a.dom.domNode(d).prev(g):d:null},next:function(g){var d=f.nextSibling;return d?!a.lang.array(g&&g.nodeTypes?g.nodeTypes:b).contains(d.nodeType)||g&&g.ignoreBlankTexts&&d.nodeType===a.TEXT_NODE&&/^\s*$/g.test(d.data)?a.dom.domNode(d).next(g): d:null},lastLeafNode:function(b){var d;if(1!==f.nodeType)return f;d=f.lastChild;if(!d)return f;if(b&&b.leafClasses)for(var k=b.leafClasses.length;k--;)if(a.dom.hasClass(f,b.leafClasses[k]))return f;return a.dom.domNode(d).lastLeafNode(b)},test:function(b){var d;if(!b||1!==f.nodeType||b.query&&(f.matches=Element.prototype.matches,!f.matches(b.query))||b.nodeName&&f.nodeName!==b.nodeName||b.className&&!f.classList.contains(b.className)||b.classRegExp&&0===((f.className||"").match(b.classRegExp)||[]).length)return!1; if(b.styleProperty&&0<b.styleProperty.length){d=Array.isArray(b.styleProperty)?b.styleProperty:[b.styleProperty];for(var k=d.length;0<k;){d=a.browser.fixStyleKey(d[0]);if(f.style[d])if(b.styleValue)if(b.styleValue instanceof RegExp){if(0<f.style[d].trim().match(b.styleValue).length)break}else if(Array.isArray(b.styleValue)){if(b.styleValue.indexOf(f.style[d].trim()))break}else{if(b.styleValue===f.style[d].trim())break}else break;return!1}}return!0}}}})(wysihtml5); wysihtml5.dom.getAsDom=function(){var a="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(f,b){b=b||document;var g;if("object"===typeof f&&f.nodeType)g=b.createElement("div"),g.appendChild(f);else if(wysihtml5.browser.supportsHTML5Tags(b))g=b.createElement("div"),g.innerHTML=f;else{g=b;if(!g._wysihtml5_supportsHTML5Tags){for(var d= 0,k=a.length;d<k;d++)g.createElement(a[d]);g._wysihtml5_supportsHTML5Tags=!0}g=b;d=g.createElement("div");d.style.display="none";g.body.appendChild(d);try{d.innerHTML=f}catch(h){}g.body.removeChild(d);g=d}return g}}();wysihtml5.dom.getParentElement=function(){return function(a,f,b,g){for(b=b||50;b--&&a&&"BODY"!==a.nodeName&&(!g||a!==g);){if(wysihtml5.dom.domNode(a).test(f))return a;a=a.parentNode}return null}}(); wysihtml5.dom.getStyle=function(){function a(a){return a.replace(b,function(a){return a.charAt(1).toUpperCase()})}var f={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},b=/\-[a-z]/g;return function(b){return{from:function(d){if(d.nodeType===wysihtml5.ELEMENT_NODE){var k=d.ownerDocument,h=f[b]||a(b),e=d.style,l=d.currentStyle,p=e[h];if(p)return p;if(l)try{return l[h]}catch(m){}var h=k.defaultView||k.parentWindow,k=("height"===b||"width"===b)&&"TEXTAREA"===d.nodeName, n;if(h.getComputedStyle)return k&&(n=e.overflow,e.overflow="hidden"),d=h.getComputedStyle(d,null).getPropertyValue(b),k&&(e.overflow=n||""),d}}}}}();wysihtml5.dom.getTextNodes=function(a,f){var b=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?f&&/^\s*$/.test(a.innerText||a.textContent)||b.push(a):b=b.concat(wysihtml5.dom.getTextNodes(a,f));return b}; wysihtml5.dom.hasElementWithTagName=function(){var a={},f=1;return function(b,g){var d=(b._wysihtml5_identifier||(b._wysihtml5_identifier=f++))+":"+g,k=a[d];k||(k=a[d]=b.getElementsByTagName(g));return 0<k.length}}();(function(a){var f={},b=1;a.dom.hasElementWithClassName=function(g,d){if(!a.browser.supportsNativeGetElementsByClassName())return!!g.querySelector("."+d);var k=(g._wysihtml5_identifier||(g._wysihtml5_identifier=b++))+":"+d,h=f[k];h||(h=f[k]=g.getElementsByClassName(d));return 0<h.length}})(wysihtml5); wysihtml5.dom.insert=function(a){return{after:function(f){f.parentNode.insertBefore(a,f.nextSibling)},before:function(f){f.parentNode.insertBefore(a,f)},into:function(f){f.appendChild(a)}}};wysihtml5.dom.insertCSS=function(a){a=a.join("\n");return{into:function(f){var b=f.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText=a:b.appendChild(f.createTextNode(a));var g=f.querySelector("head link");g?g.parentNode.insertBefore(b,g):(f=f.querySelector("head"))&&f.appendChild(b)}}}; (function(a){a.dom.lineBreaks=function(f){function b(b){return"BR"===b.nodeName||"block"===a.dom.getStyle("display").from(b)?!0:!1}return{add:function(g){g=f.ownerDocument;var d=a.dom.domNode(f).next({ignoreBlankTexts:!0}),k=a.dom.domNode(f).prev({ignoreBlankTexts:!0});d&&!b(d)&&a.dom.insert(g.createElement("br")).after(f);k&&!b(k)&&a.dom.insert(g.createElement("br")).before(f)},remove:function(b){b=a.dom.domNode(f).next({ignoreBlankTexts:!0});var d=a.dom.domNode(f).prev({ignoreBlankTexts:!0});b&& "BR"===b.nodeName&&b.parentNode.removeChild(b);d&&"BR"===d.nodeName&&d.parentNode.removeChild(d)}}}})(wysihtml5); wysihtml5.dom.observe=function(a,f,b){f="string"===typeof f?[f]:f;for(var g,d,k=0,h=f.length;k<h;k++)d=f[k],a.addEventListener?a.addEventListener(d,b,!1):(g=function(e){"target"in e||(e.target=e.srcElement);e.preventDefault=e.preventDefault||function(){this.returnValue=!1};e.stopPropagation=e.stopPropagation||function(){this.cancelBubble=!0};b.call(a,e)},a.attachEvent("on"+d,g));return{stop:function(){for(var e,d=0,h=f.length;d<h;d++)e=f[d],a.removeEventListener?a.removeEventListener(e,b,!1):a.detachEvent("on"+ e,g)}}}; wysihtml5.dom.parse=function(a,f){function b(a,d,f,g){var k=a.nodeType,l=a.childNodes,m=l.length,p=h[k],q=0,r;if(g&&1===k&&wysihtml5.dom.hasClass(a,g))return a;p=p&&p(a,f);if(!p){if(!1===p){k=a.ownerDocument.createDocumentFragment();for(q=m;q--;)l[q]&&(r=b(l[q],d,f,g))&&(l[q]===r&&q--,k.insertBefore(r,k.firstChild));d=wysihtml5.dom.getStyle("display").from(a);""===d&&(d=wysihtml5.lang.array(n).contains(a.tagName)?"block":"");wysihtml5.lang.array(["block","flex","table"]).contains(d)&&k.appendChild(a.ownerDocument.createElement("br"));wysihtml5.lang.array("div pre p table td th ul ol li dd dl footer header section h1 h2 h3 h4 h5 h6".split(" ")).contains(a.nodeName.toLowerCase())&& a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||k.appendChild(a.ownerDocument.createTextNode(" ")));k.normalize&&k.normalize();return k}return null}for(q=0;q<m;q++)l[q]&&(r=b(l[q],d,f,g))&&(l[q]===r&&q--,p.appendChild(r));if(d&&p.nodeName.toLowerCase()===e&&(!p.childNodes.length||/^\s*$/gi.test(p.innerHTML)&&(f||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!p.attributes.length)){for(k=p.ownerDocument.createDocumentFragment();p.firstChild;)k.appendChild(p.firstChild); k.normalize&&k.normalize();return k}p.normalize&&p.normalize();return p}function g(a,e){var d=a.getAttribute("class"),b=a.getAttribute("style"),f,h,g;if(e.methods)for(f in e.methods)if(e.methods.hasOwnProperty(f)&&t[f]&&t[f](a))return!0;if(d&&e.classes){d=d.replace(/^\s+/g,"").replace(/\s+$/g,"").split(l);f=d.length;for(var k=0;k<f;k++)if(e.classes[d[k]])return!0}if(b&&e.styles)for(h in b=b.split(";"),e.styles)if(e.styles.hasOwnProperty(h))for(f=b.length;f--;)if(d=b[f].split(":"),d[0].replace(/\s/g, "").toLowerCase()===h&&(!0===e.styles[h]||1===e.styles[h]||wysihtml5.lang.array(e.styles[h]).contains(d[1].replace(/\s/g,"").toLowerCase())))return!0;if(e.attrs)for(g in e.attrs)if(e.attrs.hasOwnProperty(g)&&(b=wysihtml5.dom.getAttribute(a,g),"string"===typeof b&&-1<b.search(e.attrs[g])))return!0;return!1}function d(a,e,d,b){return(d=q[d])&&(e||"alt"===a&&"IMG"==b)&&(a=d(e),"string"===typeof a)?a:!1}function k(a,e){var b=wysihtml5.lang.object(m.attributes||{}).clone(),b=wysihtml5.lang.object(b).merge(wysihtml5.lang.object(e|| {}).clone()).get(),f={},h=wysihtml5.dom.getAttributes(a),g,k,l;for(g in b)if(/\*$/.test(g)){k=g.slice(0,-1);l=h;var n=[],p=void 0;for(p in l)l.hasOwnProperty(p)&&0===p.indexOf(k)&&n.push(p);l=n;n=0;for(p=l.length;n<p;n++)k=d(l[n],h[l[n]],b[g],a.nodeName),!1!==k&&(f[l[n]]=k)}else k=d(g,h[g],b[g],a.nodeName),!1!==k&&(f[g]=k);return f}var h={1:function(a,d){var b,f;b=m.tags;f=a.nodeName.toLowerCase();var h=a.scopeName,n;if(a._wysihtml5)return null;a._wysihtml5=1;if("wysihtml5-temp"===a.className)return null; h&&"HTML"!=h&&(f=h+":"+f);"outerHTML"in a&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(f="div"));if(f in b){b=b[f];if(!b||b.remove)return null;if(b.unwrap)return!1;b="string"===typeof b?{rename_tag:b}:b}else if(a.firstChild)b={rename_tag:e};else return null;if(h=b.one_of_type){var p;a:{var h=m,q=b.one_of_type,t;if("SPAN"!==a.nodeName||d||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className){for(p in q)if(q.hasOwnProperty(p)&& h.type_definitions&&h.type_definitions[p]&&(t=h.type_definitions[p],g(a,t))){p=!0;break a}p=!1}else p=!0}h=!p}if(h)if(b.remove_action){if("unwrap"===b.remove_action)return!1;if("rename"===b.remove_action)n=b.remove_action_rename_to||e;else return null}else return null;f=a.ownerDocument.createElement(n||b.rename_tag||f);var w=b;n={};var M=w.set_class,L=w.add_class,X=w.add_style,pa=w.set_attributes;p=m.classes;h=0;q=[];t=[];var fa=[],ka=[],J;pa&&(n=wysihtml5.lang.object(pa).clone());n=wysihtml5.lang.object(n).merge(k(a, w.check_attributes)).get();M&&q.push(M);if(L)for(J in L)if(w=v[L[J]])w=w(wysihtml5.dom.getAttribute(a,J)),"string"===typeof w&&q.push(w);if(X)for(J in X)if(w=r[X[J]])newStyle=w(wysihtml5.dom.getAttribute(a,J)),"string"===typeof newStyle&&t.push(newStyle);if("string"===typeof p&&"any"===p&&a.getAttribute("class"))if(m.classes_blacklist){(ka=a.getAttribute("class"))&&(q=q.concat(ka.split(l)));for(L=q.length;h<L;h++)X=q[h],m.classes_blacklist[X]||fa.push(X);fa.length&&(n["class"]=wysihtml5.lang.array(fa).unique().join(" "))}else n["class"]= a.getAttribute("class");else{d||(p["_wysihtml5-temp-placeholder"]=1,p._rangySelectionBoundary=1,p["wysiwyg-tmp-selected-cell"]=1);(ka=a.getAttribute("class"))&&(q=q.concat(ka.split(l)));for(L=q.length;h<L;h++)X=q[h],p[X]&&fa.push(X);fa.length&&(n["class"]=wysihtml5.lang.array(fa).unique().join(" "))}n["class"]&&d&&(n["class"]=n["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(n["class"])&&delete n["class"]);t.length&&(n.style=wysihtml5.lang.array(t).unique().join(" "));for(J in n)try{f.setAttribute(J, n[J])}catch(va){}n.src&&("undefined"!==typeof n.width&&f.setAttribute("width",n.width),"undefined"!==typeof n.height&&f.setAttribute("height",n.height));J=b;var Y;if(J&&J.keep_styles)for(Y in J.keep_styles)J.keep_styles.hasOwnProperty(Y)&&(b="float"===Y?a.style.styleFloat||a.style.cssFloat:a.style[Y],J.keep_styles[Y]instanceof RegExp&&!J.keep_styles[Y].test(b)||("float"===Y?f.style[a.style.styleFloat?"styleFloat":"cssFloat"]=b:a.style[Y]&&(f.style[Y]=b)));f.normalize&&f.normalize();return f},3:function(a){var e= a.nextSibling;if(e&&e.nodeType===wysihtml5.TEXT_NODE)e.data=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")+e.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"");else return e=a.data.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,""),a.ownerDocument.createTextNode(e)},8:function(a){if(m.comments)return a.ownerDocument.createComment(a.nodeValue)}},e="span",l=/\s+/,p={tags:{},classes:{}},m={},n="ADDRESS BLOCKQUOTE CENTER DIR DIV DL FIELDSET FORM H1 H2 H3 H4 H5 H6 ISINDEX MENU NOFRAMES NOSCRIPT OL P PRE TABLE UL".split(" "), q={url:function(){var a=/^https?:\/\//i;return function(e){return e&&e.match(a)?e.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(e){return e&&e.match(a)?e.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(e){return e&&e.match(a)?e.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(e){return e? e.replace(a,""):""}}(),numbers:function(){var a=/\D/g;return function(e){return(e=(e||"").replace(a,""))||null}}(),dimension:function(){var a=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(e){return(e=(e||"").replace(a,"$1$2$3"))||null}}(),any:function(){return function(a){return a}}()},r={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(e){return a[String(e).toLowerCase()]}}()},v={align_img:function(){var a={left:"wysiwyg-float-left", right:"wysiwyg-float-right"};return function(e){return a[String(e).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(e){return a[String(e).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(e){return a[String(e).toLowerCase()]}}(),size_font:function(){var a= {1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(e){return a[String(e).charAt(0)]}}()},t={has_visible_contet:function(){var a,e="img video picture br script noscript style table iframe object embed audio svg input button select textarea canvas".split(" ");return function(d){if((a= (d.innerText||d.textContent).replace(/\s/g,""))&&0<a.length)return!0;for(var b=e.length;b--;)if(d.querySelector(e[b]))return!0;return d.offsetWidth&&0<d.offsetWidth&&d.offsetHeight&&0<d.offsetHeight?!0:!1}}()},w={unwrap:function(a){wysihtml5.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return function(a,e){wysihtml5.lang.object(m).merge(p).merge(e.rules).get();var d=e.context||a.ownerDocument||document,f=d.createDocumentFragment(),h="string"===typeof a,g=!1,k,l;!0===e.clearInternals&& (g=!0);d=h?wysihtml5.dom.getAsDom(a,d):a;if(m.selectors){var n=m.selectors,q;for(k in n)if(n.hasOwnProperty(k)){wysihtml5.lang.object(n[k]).isFunction()?l=n[k]:"string"===typeof n[k]&&w[n[k]]&&(l=w[n[k]]);q=d.querySelectorAll(k);for(var r=q.length;r--;)l(q[r])}}for(;d.firstChild;)l=d.firstChild,(k=b(l,e.cleanUp,g,e.uneditableClass))&&f.appendChild(k),l!==k&&d.removeChild(l);if(e.unjoinNbsps)for(g=wysihtml5.dom.getTextNodes(f),k=g.length;k--;)g[k].nodeValue=g[k].nodeValue.replace(/([\S\u00A0])\u00A0/gi, "$1 ");d.innerHTML="";d.appendChild(f);return h?wysihtml5.quirks.getCorrectInnerHTML(d):d}(a,f)};wysihtml5.dom.removeEmptyTextNodes=function(a){for(var f=wysihtml5.lang.array(a.childNodes).get(),b=f.length,g=0;g<b;g++)a=f[g],a.nodeType===wysihtml5.TEXT_NODE&&""===a.data&&a.parentNode.removeChild(a)}; wysihtml5.dom.renameElement=function(a,f){for(var b=a.ownerDocument.createElement(f),g;g=a.firstChild;)b.appendChild(g);wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(b);a.parentNode.replaceChild(b,a);return b};wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode)if(a.firstChild){for(var f=a.ownerDocument.createDocumentFragment();a.firstChild;)f.appendChild(a.firstChild);a.parentNode.replaceChild(f,a)}else a.parentNode.removeChild(a)}; (function(a){function f(b){return"block"===a.getStyle("display").from(b)}function b(a){var d=a.ownerDocument.createElement("br");a.appendChild(d)}a.resolveList=function(a,d){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var k=a.ownerDocument,h=k.createDocumentFragment(),e=wysihtml5.dom.domNode(a).prev({ignoreBlankTexts:!0}),l,p;if(d)for(e&&!f(e)&&"BR"!==e.nodeName&&b(h);p=a.firstElementChild||a.firstChild;){for(k=p.lastChild;e=p.firstChild;)l=(l=e===k)&&!f(e)&&"BR"!==e.nodeName,h.appendChild(e),l&&b(h); p.parentNode.removeChild(p)}else for(;p=a.firstElementChild||a.firstChild;){if(p.querySelector&&p.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;e=p.firstChild;)h.appendChild(e);else{for(l=k.createElement("p");e=p.firstChild;)l.appendChild(e);h.appendChild(l)}p.parentNode.removeChild(p)}a.parentNode.replaceChild(h,a)}}})(wysihtml5.dom); (function(a){var f=document,b="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),g="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),d=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(d,b){this.callback=d||a.EMPTY_FUNCTION;this.config=a.lang.object({}).merge(b).get();this.editableArea=this._createIframe()},insertInto:function(a){"string"=== typeof a&&(a=f.getElementById(a));a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var d=this,b=f.createElement("iframe");b.className="wysihtml5-sandbox";a.dom.setAttributes({security:"restricted",allowtransparency:"true", frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(b);a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(b.src="javascript:'<html></html>'");b.onload=function(){b.onreadystatechange=b.onload=null;d._onLoadIframe(b)};b.onreadystatechange=function(){/loaded|complete/.test(b.readyState)&&(b.onreadystatechange=b.onload=null,d._onLoadIframe(b))};return b},_onLoadIframe:function(k){if(a.dom.contains(f.documentElement,k)){var h=this,e=k.contentWindow,l=k.contentWindow.document,p=this._getHtml({charset:f.characterSet|| f.charset||"utf-8",stylesheets:this.config.stylesheets});l.open("text/html","replace");l.write(p);l.close();this.getWindow=function(){return k.contentWindow};this.getDocument=function(){return k.contentWindow.document};e.onerror=function(a,e,d){throw Error("wysihtml5.Sandbox: "+a,e,d);};if(!a.browser.supportsSandboxedIframes()){var m,p=0;for(m=b.length;p<m;p++)this._unset(e,b[p]);p=0;for(m=g.length;p<m;p++)this._unset(e,g[p],a.EMPTY_FUNCTION);p=0;for(m=d.length;p<m;p++)this._unset(l,d[p]);this._unset(l, "cookie","",!0)}this.loaded=!0;setTimeout(function(){h.callback(h)},0)}},_getHtml:function(d){var b=d.stylesheets,e="",f=0,g;if(b="string"===typeof b?[b]:b)for(g=b.length;f<g;f++)e+='<link rel="stylesheet" href="'+b[f]+'">';d.stylesheets=e;return a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(d)},_unset:function(d,b,e,f){try{d[b]=e}catch(g){}try{d.__defineGetter__(b,function(){return e})}catch(m){}if(f)try{d.__defineSetter__(b, function(){})}catch(n){}if(!a.browser.crashesWhenDefineProperty(b))try{var q={get:function(){return e}};f&&(q.set=function(){});Object.defineProperty(d,b,q)}catch(r){}}})})(wysihtml5); (function(a){var f=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(b,f,d){this.callback=b||a.EMPTY_FUNCTION;this.config=a.lang.object({}).merge(f).get();this.element=d?this._bindElement(d):this._createElement()},_createElement:function(){var a=f.createElement("div");a.className="wysihtml5-sandbox";this._loadElement(a); return a},_bindElement:function(a){a.className=a.className&&""!=a.className?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox";this._loadElement(a,!0);return a},_loadElement:function(a,f){var d=this;if(!f){var k=this._getHtml();a.innerHTML=k}this.getWindow=function(){return a.ownerDocument.defaultView};this.getDocument=function(){return a.ownerDocument};this.loaded=!0;setTimeout(function(){d.callback(d)},0)},_getHtml:function(a){return""}})})(wysihtml5); (function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(f){return{on:function(b){for(var g in f)b.setAttribute(a[g]||g,f[g])}}}})();wysihtml5.dom.setStyles=function(a){return{on:function(f){f=f.style;if("string"===typeof a)f.cssText+=";"+a;else for(var b in a)"float"===b?(f.cssFloat=a[b],f.styleFloat=a[b]):f[b]=a[b]}}}; (function(a){a.simulatePlaceholder=function(f,b,g){var d=function(){var d=0<b.element.offsetWidth&&0<b.element.offsetHeight;b.hasPlaceholderSet()&&(b.clear(),b.element.focus(),d&&setTimeout(function(){var a=b.selection.getSelection();a.focusNode&&a.anchorNode||b.selection.selectNode(b.element.firstChild||b.element)},0));b.placeholderSet=!1;a.removeClass(b.element,"placeholder")},k=function(){b.isEmpty()&&(b.placeholderSet=!0,b.setValue(g),a.addClass(b.element,"placeholder"))};f.on("set_placeholder", k).on("unset_placeholder",d).on("focus:composer",d).on("paste:composer",d).on("blur:composer",k);k()}})(wysihtml5.dom);(function(a){var f=document.documentElement;"textContent"in f?(a.setTextContent=function(a,f){a.textContent=f},a.getTextContent=function(a){return a.textContent}):"innerText"in f?(a.setTextContent=function(a,f){a.innerText=f},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,f){a.nodeValue=f},a.getTextContent=function(a){return a.nodeValue})})(wysihtml5.dom); wysihtml5.dom.getAttribute=function(a,f){var b=!wysihtml5.browser.supportsGetAttributeCorrectly();f=f.toLowerCase();return"IMG"==a.nodeName&&"src"==f&&!0===wysihtml5.dom.isLoadedImage(a)?a.src:b&&"outerHTML"in a?-1!=a.outerHTML.toLowerCase().indexOf(" "+f+"=")?a.getAttribute(f):null:a.getAttribute(f)}; wysihtml5.dom.getAttributes=function(a){var f=!wysihtml5.browser.supportsGetAttributeCorrectly(),b=a.nodeName,g=[],d;for(d in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(d)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,d))&&a.attributes[d].specified&&("IMG"==b&&"src"==a.attributes[d].name.toLowerCase()&&!0===wysihtml5.dom.isLoadedImage(a)?g.src=a.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(a.attributes[d].name.toLowerCase())&& f?1!==a.attributes[d].value&&(g[a.attributes[d].name]=a.attributes[d].value):g[a.attributes[d].name]=a.attributes[d].value);return g};wysihtml5.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(f){if(a.complete&&"complete"===a.readyState)return!0}}; (function(a){function f(a,d){for(var b=[],f,h=0,g=a.length;h<g;h++)if(f=a[h].querySelectorAll(d))for(var k=f.length;k--;b.unshift(f[k]));return b}function b(a){a.parentNode.removeChild(a)}function g(a,d){a.parentNode.insertBefore(d,a.nextSibling)}var d=a.dom,k=function(a){this.el=a;this.isRowspan=this.isColspan=!1;this.isReal=this.lastRow=this.firstRow=this.lastCol=this.firstCol=!0;this.spanCollection=[];this.modified=!1},h=function(a,b){a?(this.cell=a,this.table=d.getParentElement(a,{query:"table"})): b&&(this.table=b,this.cell=this.table.querySelectorAll("th, td")[0])};h.prototype={addSpannedCellToMap:function(a,d,b,f,h,g){for(var r=[],v=b+(g?parseInt(g,10)-1:0),t=f+(h?parseInt(h,10)-1:0),w=b;w<=v;w++){"undefined"==typeof d[w]&&(d[w]=[]);for(var x=f;x<=t;x++)d[w][x]=new k(a),d[w][x].isColspan=h&&1<parseInt(h,10),d[w][x].isRowspan=g&&1<parseInt(g,10),d[w][x].firstCol=x==f,d[w][x].lastCol=x==t,d[w][x].firstRow=w==b,d[w][x].lastRow=w==v,d[w][x].isReal=x==f&&w==b,d[w][x].spanCollection=r,r.push(d[w][x])}}, setCellAsModified:function(a){a.modified=!0;if(0<a.spanCollection.length)for(var d=0,b=a.spanCollection.length;d<b;d++)a.spanCollection[d].modified=!0},setTableMap:function(){var a=[],b=this.getTableRows(),f,h,g,q,r,v,t;for(f=0;f<b.length;f++)for(h=b[f],h=this.getRowCells(h),r=0,"undefined"==typeof a[f]&&(a[f]=[]),g=0;g<h.length;g++){for(q=h[g];"undefined"!=typeof a[f][r];)r++;v=d.getAttribute(q,"colspan");t=d.getAttribute(q,"rowspan");v||t?(this.addSpannedCellToMap(q,a,f,r,v,t),r+=v?parseInt(v,10): 1):(a[f][r]=new k(q),r++)}return this.map=a},getRowCells:function(e){var d=this.table.querySelectorAll("table"),d=d?f(d,"th, td"):[];e=e.querySelectorAll("th, td");return 0<d.length?a.lang.array(e).without(d):e},getTableRows:function(){var e=this.table.querySelectorAll("table"),e=e?f(e,"tr"):[],d=this.table.querySelectorAll("tr");return 0<e.length?a.lang.array(d).without(e):d},getMapIndex:function(a){for(var d=this.map.length,b=this.map&&this.map[0]?this.map[0].length:0,f=0;f<d;f++)for(var h=0;h< b;h++)if(this.map[f][h].el===a)return{row:f,col:h};return!1},getElementAtIndex:function(a){this.setTableMap();return this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el?this.map[a.row][a.col].el:null},getMapElsTo:function(a){var d=[];this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(a);if(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)a=this.idx_start,this.idx_start=this.idx_end, this.idx_end=a;this.idx_start.col>this.idx_end.col&&(a=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=a);if(null!=this.idx_start&&null!=this.idx_end){a=this.idx_start.row;for(var b=this.idx_end.row;a<=b;a++)for(var f=this.idx_start.col,h=this.idx_end.col;f<=h;f++)d.push(this.map[a][f].el)}return d},orderSelectionEnds:function(a){this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(a);if(this.idx_start.row>this.idx_end.row||this.idx_start.row== this.idx_end.row&&this.idx_start.col>this.idx_end.col)a=this.idx_start,this.idx_start=this.idx_end,this.idx_end=a;this.idx_start.col>this.idx_end.col&&(a=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=a);return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(a,d,b){for(var f=this.table.ownerDocument,h=f.createDocumentFragment(),g,k=0;k<d;k++){g=f.createElement(a);if(b)for(var v in b)b.hasOwnProperty(v)&& g.setAttribute(v,b[v]);g.appendChild(document.createTextNode("\u00a0"));h.appendChild(g)}return h},correctColIndexForUnreals:function(a,d){for(var b=this.map[d],f=-1,h=0;h<a;h++)b[h].isReal&&f++;return f},getLastNewCellOnRow:function(a,d){for(var b=this.getRowCells(a),f,h,g=0,k=b.length;g<k;g++)if(f=b[g],h=this.getMapIndex(f),!1===h||"undefined"!=typeof d&&h.row!=d)return f;return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");if(a&&0!=a.length)return!1;b(this.table); return!0},splitRowToCells:function(a){if(a.isColspan){var b=parseInt(d.getAttribute(a.el,"colspan")||1,10),f=a.el.tagName.toLowerCase();1<b&&(b=this.createCells(f,b-1),g(a.el,b));a.el.removeAttribute("colspan")}},getRealRowEl:function(a,b){var f=null,h=null;b=b||this.idx;for(var g=0,k=this.map[b.row].length;g<k;g++)if(h=this.map[b.row][g],h.isReal&&(f=d.getParentElement(h.el,{query:"tr"})))return f;null===f&&a&&(f=d.getParentElement(this.map[b.row][b.col].el,{query:"tr"})||null);return f},injectRowAt:function(a, b,f,h,k){var q=this.getRealRowEl(!1,{row:a,col:b});f=this.createCells(h,f);q?(k=this.correctColIndexForUnreals(b,a),0<=k?g(this.getRowCells(q)[k],f):q.insertBefore(f,q.firstChild)):(q=this.table.ownerDocument.createElement("tr"),q.appendChild(f),g(d.getParentElement(k.el,{query:"tr"}),q))},canMerge:function(a){this.to=a;this.setTableMap();this.idx_start=this.getMapIndex(this.cell);this.idx_end=this.getMapIndex(this.to);if(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&& this.idx_start.col>this.idx_end.col)a=this.idx_start,this.idx_start=this.idx_end,this.idx_end=a;this.idx_start.col>this.idx_end.col&&(a=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=a);a=this.idx_start.row;for(var d=this.idx_end.row;a<=d;a++)for(var b=this.idx_start.col,f=this.idx_end.col;b<=f;b++)if(this.map[a][b].isColspan||this.map[a][b].isRowspan)return!1;return!0},decreaseCellSpan:function(a,b){var f=parseInt(d.getAttribute(a.el,b),10)-1;1<=f?a.el.setAttribute(b,f): (a.el.removeAttribute(b),"colspan"==b&&(a.isColspan=!1),"rowspan"==b&&(a.isRowspan=!1),a.firstCol=!0,a.lastCol=!0,a.firstRow=!0,a.lastRow=!0,a.isReal=!0)},removeSurplusLines:function(){var a,f,h,g,k,q,r;this.setTableMap();if(this.map){h=0;for(g=this.map.length;h<g;h++){a=this.map[h];r=!0;k=0;for(q=a.length;k<q;k++)if(f=a[k],!(d.getAttribute(f.el,"rowspan")&&1<parseInt(d.getAttribute(f.el,"rowspan"),10)&&!0!==f.firstRow)){r=!1;break}if(r)for(k=0;k<q;k++)this.decreaseCellSpan(a[k],"rowspan")}f=this.getTableRows(); h=0;for(g=f.length;h<g;h++)a=f[h],0==a.childNodes.length&&/^\s*$/.test(a.textContent||a.innerText)&&b(a)}},fillMissingCells:function(){var a=0,d=0,b=null;this.setTableMap();if(this.map){a=this.map.length;for(b=0;b<a;b++)this.map[b].length>d&&(d=this.map[b].length);for(var f=0;f<a;f++)for(var h=0;h<d;h++)this.map[f]&&!this.map[f][h]&&0<h&&(this.map[f][h]=new k(this.createCells("td",1)),(b=this.map[f][h-1])&&b.el&&b.el.parent&&g(this.map[f][h-1].el,this.map[f][h].el))}},rectify:function(){if(this.removeEmptyTable())return!1; this.removeSurplusLines();this.fillMissingCells();return!0},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell))){var a=this.map[this.idx.row][this.idx.col],b=d.getAttribute(a.el,"colspan")?parseInt(d.getAttribute(a.el,"colspan"),10):1,f=a.el.tagName.toLowerCase();if(a.isRowspan){var h=parseInt(d.getAttribute(a.el,"rowspan"),10);if(1<h)for(var g=1,h=h-1;g<=h;g++)this.injectRowAt(this.idx.row+g,this.idx.col,b,f,a);a.el.removeAttribute("rowspan")}this.splitRowToCells(a)}}, merge:function(a){if(this.rectify())if(this.canMerge(a)){a=this.idx_end.row-this.idx_start.row+1;for(var d=this.idx_end.col-this.idx_start.col+1,f=this.idx_start.row,h=this.idx_end.row;f<=h;f++)for(var g=this.idx_start.col,k=this.idx_end.col;g<=k;g++)f==this.idx_start.row&&g==this.idx_start.col?(1<a&&this.map[f][g].el.setAttribute("rowspan",a),1<d&&this.map[f][g].el.setAttribute("colspan",d)):(/^\s*<br\/?>\s*$/.test(this.map[f][g].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+= " "+this.map[f][g].el.innerHTML),b(this.map[f][g].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(a){var b=this.getMapIndex(a.el),f=b.row+1,h={row:f,col:b.col};f<this.map.length&&(b=this.getRealRowEl(!1,h),null!==b&&(h=this.correctColIndexForUnreals(h.col,h.row),0<=h?g(this.getRowCells(b)[h],a.el):(f=this.getLastNewCellOnRow(b,f),null!==f?g(f,a.el):b.insertBefore(a.el,b.firstChild)),2<parseInt(d.getAttribute(a.el, "rowspan"),10)?a.el.setAttribute("rowspan",parseInt(d.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")))},removeRowCell:function(a){a.isReal?a.isRowspan?this.collapseCellToNextRow(a):b(a.el):2<parseInt(d.getAttribute(a.el,"rowspan"),10)?a.el.setAttribute("rowspan",parseInt(d.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var a=[];this.setTableMap();this.idx=this.getMapIndex(this.cell);if(!1!==this.idx)for(var d=this.map[this.idx.row], b=0,f=d.length;b<f;b++)d[b].isReal&&a.push(d[b].el);return a},getColumnElementsByCell:function(){var a=[];this.setTableMap();this.idx=this.getMapIndex(this.cell);if(!1!==this.idx)for(var d=0,b=this.map.length;d<b;d++)this.map[d][this.idx.col]&&this.map[d][this.idx.col].isReal&&a.push(this.map[d][this.idx.col].el);return a},removeRow:function(){var a=d.getParentElement(this.cell,{query:"tr"});if(a){this.setTableMap();this.idx=this.getMapIndex(this.cell);if(!1!==this.idx)for(var f=this.map[this.idx.row], h=0,g=f.length;h<g;h++)f[h].modified||(this.setCellAsModified(f[h]),this.removeRowCell(f[h]));b(a)}},removeColCell:function(a){a.isColspan?2<parseInt(d.getAttribute(a.el,"colspan"),10)?a.el.setAttribute("colspan",parseInt(d.getAttribute(a.el,"colspan"),10)-1):a.el.removeAttribute("colspan"):a.isReal&&b(a.el)},removeColumn:function(){this.setTableMap();this.idx=this.getMapIndex(this.cell);if(!1!==this.idx)for(var a=0,d=this.map.length;a<d;a++)this.map[a][this.idx.col].modified||(this.setCellAsModified(this.map[a][this.idx.col]), this.removeColCell(this.map[a][this.idx.col]))},remove:function(a){if(this.rectify()){switch(a){case "row":this.removeRow();break;case "column":this.removeColumn()}this.rectify()}},addRow:function(a){var b=this.table.ownerDocument;this.setTableMap();this.idx=this.getMapIndex(this.cell);"below"==a&&d.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(d.getAttribute(this.cell,"rowspan"),10)-1);if(!1!==this.idx){for(var f=this.map[this.idx.row],b=b.createElement("tr"),h=0,k=f.length;h< k;h++)f[h].modified||(this.setCellAsModified(f[h]),this.addRowCell(f[h],b,a));switch(a){case "below":g(this.getRealRowEl(!0),b);break;case "above":(a=d.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"}))&&a.parentNode.insertBefore(b,a)}}},addRowCell:function(a,b,f){var h=a.isColspan?{colspan:d.getAttribute(a.el,"colspan")}:null;a.isReal?"above"!=f&&a.isRowspan?a.el.setAttribute("rowspan",parseInt(d.getAttribute(a.el,"rowspan"),10)+1):b.appendChild(this.createCells("td",1,h)):"above"!= f&&a.isRowspan&&a.lastRow?b.appendChild(this.createCells("td",1,h)):c.isRowspan&&a.el.attr("rowspan",parseInt(d.getAttribute(a.el,"rowspan"),10)+1)},add:function(a){this.rectify()&&("below"!=a&&"above"!=a||this.addRow(a),"before"!=a&&"after"!=a||this.addColumn(a))},addColCell:function(a,b,f){var h,k=a.el.tagName.toLowerCase();switch(f){case "before":h=!a.isColspan||a.firstCol;break;case "after":h=!a.isColspan||a.lastCol||a.isColspan&&c.el==this.cell}if(h){switch(f){case "before":a.el.parentNode.insertBefore(this.createCells(k, 1),a.el);break;case "after":g(a.el,this.createCells(k,1))}a.isRowspan&&this.handleCellAddWithRowspan(a,b+1,f)}else a.el.setAttribute("colspan",parseInt(d.getAttribute(a.el,"colspan"),10)+1)},addColumn:function(a){var b;this.setTableMap();this.idx=this.getMapIndex(this.cell);"after"==a&&d.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(d.getAttribute(this.cell,"colspan"),10)-1);if(!1!==this.idx)for(var f=0,h=this.map.length;f<h;f++)b=this.map[f],b[this.idx.col]&&(b=b[this.idx.col], b.modified||(this.setCellAsModified(b),this.addColCell(b,f,a)))},handleCellAddWithRowspan:function(a,b,f){var h=parseInt(d.getAttribute(this.cell,"rowspan"),10)-1,k=d.getParentElement(a.el,{query:"tr"});a=a.el.tagName.toLowerCase();for(var q,r,v=this.table.ownerDocument,t=0;t<h;t++){q=this.correctColIndexForUnreals(this.idx.col,b+t);a:{for(k=k.nextSibling;1!=k.nodeType;)if(k=k.nextSibling,"tr"==k.tagName.toLowerCase())break a;k=null}if(k)if(0<q)switch(f){case "before":r=this.getRowCells(k);0<q&&this.map[b+ t][this.idx.col].el!=r[q]&&q==r.length-1?g(r[q],this.createCells(a,1)):r[q].parentNode.insertBefore(this.createCells(a,1),r[q]);break;case "after":g(this.getRowCells(k)[q],this.createCells(a,1))}else k.insertBefore(this.createCells(a,1),k.firstChild);else q=v.createElement("tr"),q.appendChild(this.createCells(a,1)),this.table.appendChild(q)}}};d.table={getCellsBetween:function(a,d){return(new h(a)).getMapElsTo(d)},addCells:function(a,d){(new h(a)).add(d)},removeCells:function(a,d){(new h(a)).remove(d)}, mergeCellsBetween:function(a,d){(new h(a)).merge(d)},unmergeCell:function(a){(new h(a)).unmerge()},orderSelectionEnds:function(a,d){return(new h(a)).orderSelectionEnds(d)},indexOf:function(a){var d=new h(a);d.setTableMap();return d.getMapIndex(a)},findCell:function(a,d){return(new h(null,a)).getElementAtIndex(d)},findRowByCell:function(a){return(new h(a)).getRowElementsByCell()},findColumnByCell:function(a){return(new h(a)).getColumnElementsByCell()},canMerge:function(a,d){return(new h(a)).canMerge(d)}}})(wysihtml5); wysihtml5.dom.query=function(a,f){var b=[],g;a.nodeType&&(a=[a]);for(var d=0,k=a.length;d<k;d++)if(g=a[d].querySelectorAll(f))for(var h=g.length;h--;b.unshift(g[h]));return b}; wysihtml5.dom.compareDocumentPosition=function(){return document.documentElement.compareDocumentPosition?function(a,f){return a.compareDocumentPosition(f)}:function(a,f){if(a===f)return 0;if(a===f.ownerDocument)return 20;if(a.ownerDocument===f)return 10;if((9===a.nodeType?a:a.ownerDocument)!==(9===f.nodeType?f:f.ownerDocument))return 1;if(2===a.nodeType&&a.childNodes&&-1!==wysihtml5.lang.array(a.childNodes).indexOf(f))return 20;if(2===f.nodeType&&f.childNodes&&-1!==wysihtml5.lang.array(f.childNodes).indexOf(a))return 10; for(var b=a,g=[],d=null;b;){if(b==f)return 10;g.push(b);b=b.parentNode}b=f;for(d=null;b;){if(b==a)return 20;var k=wysihtml5.lang.array(g).indexOf(b);if(-1!==k)return b=g[k],g=wysihtml5.lang.array(b.childNodes).indexOf(g[k-1]),d=wysihtml5.lang.array(b.childNodes).indexOf(d),g>d?2:4;d=b;b=b.parentNode}return 1}}();wysihtml5.dom.unwrap=function(a){var f=[];if(a.parentNode){for(;a.lastChild;)f.unshift(a.lastChild),wysihtml5.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}return f}; wysihtml5.dom.getPastedHtml=function(a){var f;a.clipboardData&&(wysihtml5.lang.array(a.clipboardData.types).contains("text/html")?f=a.clipboardData.getData("text/html"):wysihtml5.lang.array(a.clipboardData.types).contains("text/plain")&&(f=wysihtml5.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0)));return f}; wysihtml5.dom.getPastedHtmlWithDiv=function(a,f){var b=a.selection.getBookmark(),g=a.element.ownerDocument,d=g.createElement("DIV");g.body.appendChild(d);d.style.width="1px";d.style.height="1px";d.style.overflow="hidden";d.setAttribute("contenteditable","true");d.focus();setTimeout(function(){a.selection.setBookmark(b);f(d.innerHTML);d.parentNode.removeChild(d)},0)}; wysihtml5.dom.removeInvisibleSpaces=function(a){a=wysihtml5.dom.getTextNodes(a);for(var f=a.length;f--;)a[f].nodeValue=a[f].nodeValue.replace(wysihtml5.INVISIBLE_SPACE_REG_EXP,"")}; wysihtml5.quirks.cleanPastedHTML=function(){return function(a,f){var b={color:wysihtml5.dom.getStyle("color").from(f.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(f.referenceNode)},g;a:{g=f.rules;var d;if(g){for(var k=0,h=g.length;k<h;k++)if(g[k].condition||(d=g[k].set),g[k].condition&&g[k].condition.test(a)){g=g[k].set;break a}g=d}else g=null}g=wysihtml5.lang.object(g||{}).clone(!0);var e,l;for(e in g.tags)if(g.tags.hasOwnProperty(e)&&g.tags[e].keep_styles)for(l in g.tags[e].keep_styles)g.tags[e].keep_styles.hasOwnProperty(l)&& b[l]&&(d=g.tags[e].keep_styles,k=l,h=wysihtml5.lang.string(b[l]).trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),d[k]=new RegExp("^((?!^"+h+"$).)*$","i"));return wysihtml5.dom.parse(a,{rules:g,cleanUp:!0,context:f.referenceNode.ownerDocument,uneditableClass:f.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(); wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==b||"<p>&nbsp;</p><p>&nbsp;</p>"==b)a.innerHTML=""},0)};return function(f){wysihtml5.dom.observe(f.element,["cut","keydown"],a)}}(); (function(a){a.quirks.getCorrectInnerHTML=function(f){var b=f.innerHTML;if(-1===b.indexOf("%7E"))return b;f=f.querySelectorAll("[href*='~'], [src*='~']");var g,d,k,h;h=0;for(k=f.length;h<k;h++)g=f[h].href||f[h].src,d=a.lang.string(g).replace("~").by("%7E"),b=a.lang.string(b).replace(d).by(g);return b}})(wysihtml5); (function(a){a.quirks.redraw=function(f){a.dom.addClass(f,"wysihtml5-quirks-redraw");a.dom.removeClass(f,"wysihtml5-quirks-redraw");try{var b=f.ownerDocument;b.execCommand("italic",!1,null);b.execCommand("italic",!1,null)}catch(g){}}})(wysihtml5); wysihtml5.quirks.tableCellsSelection=function(a,f){function b(){if(a){var d=a.querySelectorAll("."+l);if(0<d.length)for(var e=0;e<d.length;e++)h.removeClass(d[e],l)}}function g(a){for(var d=0;d<a.length;d++)h.addClass(a[d],l)}function d(a){var d=null;(a=h.getParentElement(a.target,{query:"td, th"}))&&e.table&&e.start&&(d=h.getParentElement(a,{query:"table"}))&&d===e.table&&(b(),d=e.end,e.end=a,e.cells=h.table.getCellsBetween(e.start,a),1<e.cells.length&&f.composer.selection.deselect(),g(e.cells), e.end!==d&&f.fire("tableselectchange").fire("tableselectchange:composer"))}function k(e){a.removeEventListener("mousemove",d);a.removeEventListener("mouseup",k);f.fire("tableselect").fire("tableselect:composer");setTimeout(function(){a.ownerDocument.addEventListener("click",p)},0)}var h=wysihtml5.dom,e={table:null,start:null,end:null,cells:null,select:function(d,b){e.start=d;e.end=b;e.table=h.getParentElement(e.start,{query:"table"});selectedCells=h.table.getCellsBetween(e.start,e.end);g(selectedCells); a.ownerDocument.addEventListener("click",p);f.fire("tableselect").fire("tableselect:composer")}},l="wysiwyg-tmp-selected-cell",p=function(d){a.ownerDocument.removeEventListener("click",p);h.getParentElement(d.target,{query:"table"})!=e.table&&(b(),e.table=null,e.start=null,e.end=null,f.fire("tableunselect").fire("tableunselect:composer"))};a.addEventListener("mousedown",function(g){if(g=wysihtml5.dom.getParentElement(g.target,{query:"td, th"}))e.start=g,e.end=g,e.cells=[g],e.table=h.getParentElement(e.start, {query:"table"}),e.table&&(b(),h.addClass(g,l),a.addEventListener("mousemove",d),a.addEventListener("mouseup",k),f.fire("tableselectstart").fire("tableselectstart:composer"))});return e}; (function(a){var f=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,b=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,g=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,d=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,k=function(a){return new RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={parseColor:function(h,e){var l=k(e),l=h.match(l),p=10,m;if(l){for(var n=l.length;n--;)l[n]=a.lang.string(l[n].split(":")[1]).trim();l=l[l.length-1];if(f.test(l))m= l.match(f);else if(b.test(l))m=l.match(b);else if(g.test(l))m=l.match(g),p=16;else if(d.test(l))return m=l.match(d),m.shift(),m.push(1),a.lang.array(m).map(function(a,d){return 3>d?16*parseInt(a,16)+parseInt(a,16):parseFloat(a)});if(m)return m.shift(),m[3]||m.push(1),a.lang.array(m).map(function(a,d){return 3>d?parseInt(a,p):parseFloat(a)})}return!1},unparseColor:function(a,d){if(d){if("hex"==d)return a[0].toString(16).toUpperCase()+a[1].toString(16).toUpperCase()+a[2].toString(16).toUpperCase(); if("hash"==d)return"#"+a[0].toString(16).toUpperCase()+a[1].toString(16).toUpperCase()+a[2].toString(16).toUpperCase();if("rgb"==d)return"rgb("+a[0]+","+a[1]+","+a[2]+")";if("rgba"==d)return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")";if("csv"==d)return a[0]+","+a[1]+","+a[2]+","+a[3]}return a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(d){return(d=d.match(k("font-size")))?a.lang.string(d[d.length-1].split(":")[1]).trim():!1}}})(wysihtml5); (function(a){function f(a,b){for(var f=0;b!==a;)if(f++,b=b.parentNode,!b)throw Error("not a descendant of ancestor!");return f}function b(a){if(!a.canSurroundContents())for(var b=a.commonAncestorContainer,h=f(b,a.startContainer),e=f(b,a.endContainer);!a.canSurroundContents();)h>e?(a.setStartBefore(a.startContainer),h=f(b,a.startContainer)):(a.setEndAfter(a.endContainer),e=f(b,a.endContainer))}var g=a.dom;a.Selection=Base.extend({constructor:function(a,b,f){window.rangy.init();this.editor=a;this.composer= a.composer;this.doc=this.composer.doc;this.contain=b;this.unselectableClass=f||!1},getBookmark:function(){var a=this.getRange();a&&b(a);return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);b.setStartBefore(a);b.setEndBefore(a);return this.setSelection(b)},createTemporaryCaretSpaceAfter:function(d){var b=this.doc.createElement("span"),f=this.doc.createTextNode(a.INVISIBLE_SPACE),e=function(d){this.contain.removeEventListener("mouseup", e);this.contain.removeEventListener("keydown",p);this.contain.removeEventListener("touchstart",e);this.contain.removeEventListener("focus",e);this.contain.removeEventListener("blur",e);this.contain.removeEventListener("paste",g);this.contain.removeEventListener("drop",g);this.contain.removeEventListener("beforepaste",g);b&&b.parentNode&&(b.innerHTML=b.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(b.innerHTML)?(d=b.lastChild,a.dom.unwrap(b),this.setAfter(d)):b.parentNode.removeChild(b))}.bind(this), g=function(a){b&&b.parentNode&&setTimeout(e,0)},p=function(a){8===a.which||91===a.which||17===a.which||86===a.which&&(a.ctrlKey||a.metaKey)||e()};b.style.position="absolute";b.style.display="block";b.style.minWidth="1px";b.style.zIndex="99999";b.appendChild(f);d.parentNode.insertBefore(b,d.nextSibling);this.setBefore(f);this.contain.addEventListener("mouseup",e);this.contain.addEventListener("keydown",p);this.contain.addEventListener("touchstart",e);this.contain.addEventListener("focus",e);this.contain.addEventListener("blur", e);this.contain.addEventListener("paste",g);this.contain.addEventListener("drop",g);this.contain.addEventListener("beforepaste",g);return b},setAfter:function(d,b){var f=rangy.createRange(this.doc),e=this.doc.documentElement.scrollTop||this.doc.body.scrollTop||this.doc.defaultView.pageYOffset,g=this.doc.documentElement.scrollLeft||this.doc.body.scrollLeft||this.doc.defaultView.pageXOffset;f.setStartAfter(d);f.setEndAfter(d);this.composer.element.focus();this.doc.defaultView.scrollTo(g,e);f=this.setSelection(f); if(!f)if(b){var p=this.doc.createTextNode(a.INVISIBLE_SPACE);d.parentNode.insertBefore(p,d.nextSibling);this.selectNode(p);setTimeout(function(){p&&p.parentNode&&p.parentNode.removeChild(p)},0)}else this.createTemporaryCaretSpaceAfter(d);return f},selectNode:function(d,b){var f=rangy.createRange(this.doc),e=d.nodeType===a.ELEMENT_NODE,l="canHaveHTML"in d?d.canHaveHTML:"IMG"!==d.nodeName,p=e?d.innerHTML:d.data,p=""===p||p===a.INVISIBLE_SPACE,m=g.getStyle("display").from(d),m="block"===m||"list-item"=== m;if(p&&e&&l&&!b)try{d.innerHTML=a.INVISIBLE_SPACE}catch(n){}l?f.selectNodeContents(d):f.selectNode(d);l&&p&&e?f.collapse(m):l&&p&&(f.setStartAfter(d),f.setEndAfter(d));this.setSelection(f)},getSelectedNode:function(a){if(a&&this.doc.selection&&"Control"===this.doc.selection.type&&(a=this.doc.selection.createRange())&&a.length)return a.item(0);a=this.getSelection(this.doc);return a.focusNode===a.anchorNode?a.focusNode:(a=this.getRange(this.doc))?a.commonAncestorContainer:this.doc.body},fixSelBorders:function(){var a= this.getRange();b(a);this.setSelection(a)},getSelectedOwnNodes:function(a){a=this.getOwnRanges();for(var b=[],f=0,e=a.length;f<e;f++)b.push(a[f].commonAncestorContainer||this.doc.body);return b},findNodesInSelection:function(d){for(var b=this.getOwnRanges(),f=[],e,g=0,p=b.length;g<p;g++)e=b[g].getNodes([1],function(e){return a.lang.array(d).contains(e.nodeName)}),f=f.concat(e);return f},filterElements:function(a){for(var b=this.getOwnRanges(),f=[],e,g=0,p=b.length;g<p;g++)e=b[g].getNodes([1],function(e){return a(e, b[g])}),f=f.concat(e);return f},containsUneditable:function(){for(var a=this.getOwnUneditables(),b=this.getSelection(),f=0,e=a.length;f<e;f++)if(b.containsNode(a[f]))return!0;return!1},deleteContents:function(){var d=this.getRange(),b,f,e;if(this.unselectableClass)for((b=a.dom.getParentElement(d.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&d.setStartBefore(b),(f=a.dom.getParentElement(d.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&d.setEndAfter(f),b=d.getNodes([1], function(d){return a.dom.hasClass(d,this.unselectableClass)}.bind(this)),f=b.length;f--;)try{e=new CustomEvent("wysihtml5:uneditable:delete"),b[f].dispatchEvent(e)}catch(g){}d.deleteContents();this.setSelection(d)},getPreviousNode:function(d,b){var f;d||(d=this.getSelection().anchorNode);if(d===this.contain)return!1;var e=d.previousSibling;if(e===this.contain)return!1;e&&3!==e.nodeType&&1!==e.nodeType?e=this.getPreviousNode(e,b):e&&3===e.nodeType&&/^\s*$/.test(e.textContent)?e=this.getPreviousNode(e, b):b&&e&&1===e.nodeType?(f=a.dom.getStyle("display").from(e),a.lang.array(["BR","HR","IMG"]).contains(e.nodeName)||a.lang.array(["block","inline-block","flex","list-item","table"]).contains(f)||!/^[\s]*$/.test(e.innerHTML)||(e=this.getPreviousNode(e,b))):e||d===this.contain||(f=d.parentNode,f!==this.contain&&(e=this.getPreviousNode(f,b)));return e!==this.contain?e:!1},getSelectionParentsByTag:function(d){d=this.getSelectedOwnNodes();for(var b,f=[],e=0,g=d.length;e<g;e++)(b=d[e].nodeName&&"LI"===d[e].nodeName? d[e]:a.dom.getParentElement(d[e],{query:"li"},!1,this.contain))&&f.push(b);return f.length?f:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var a=this.getRange(),b=a.startContainer,a=a.startOffset,f=rangy.createRange(this.doc);f.selectNodeContents(b);f.setStart(b,a);return f}},caretIsLastInSelection:function(){rangy.createRange(this.doc);this.getSelection();var a=this.getRangeToNodeEnd().cloneContents().textContent;return/^\s*$/.test(a)},caretIsFirstInSelection:function(){var d=rangy.createRange(this.doc), b=this.getSelection(),f=this.getRange(),e=f.startContainer;if(e){if(e.nodeType===a.TEXT_NODE)return this.isCollapsed()&&e.nodeType===a.TEXT_NODE&&/^\s*$/.test(e.data.substr(0,f.startOffset));d.selectNodeContents(this.getRange().commonAncestorContainer);d.collapse(!0);return this.isCollapsed()&&(d.startContainer===b.anchorNode||d.endContainer===b.anchorNode)&&d.startOffset===b.anchorOffset}},caretIsInTheBeginnig:function(d){var b=this.getSelection(),f=b.anchorNode,b=b.anchorOffset;if(d&&f)return 0=== b&&(f.nodeName&&f.nodeName===d.toUpperCase()||a.dom.getParentElement(f.parentNode,{query:d},1));if(f)return 0===b&&!this.getPreviousNode(f,!0)},caretIsBeforeUneditable:function(){var d=this.getSelection(),b=d.anchorNode,f=d.anchorOffset,e=[];if(b)if(0===f){if(b=(b=this.getPreviousNode(b,!0))?a.dom.domNode(b).lastLeafNode(this.unselectableClass?{leafClasses:[this.unselectableClass]}:!1):null)for(e=this.getOwnUneditables(),d=0,f=e.length;d<f;d++)if(b===e[d])return e[d]}else{d=d.getRangeAt(0);d.setStart(d.startContainer, d.startOffset-1);if(d)for(var d=d.getNodes([1,3]),f=0,g=d.length;f<g;f++)d[f].parentNode&&d[f].parentNode===b&&e.push(d[f]);if((b=0<e.length?e[e.length-1]:null)&&1===b.nodeType&&a.dom.hasClass(b,this.unselectableClass))return b}return!1},executeAndRestoreRangy:function(a,b){var f=rangy.saveSelection(this.doc.defaultView||this.doc.parentWindow);if(f)try{a()}catch(e){setTimeout(function(){throw e;},0)}else a();rangy.restoreSelection(f)},executeAndRestore:function(d,b){var f=this.doc.body,e=b&&f.scrollTop, l=b&&f.scrollLeft,p='<span class="_wysihtml5-temp-placeholder">'+a.INVISIBLE_SPACE+"</span>",m=this.getRange(!0),n,q,r;if(m){m.collapsed||(r=m.cloneRange(),n=r.createContextualFragment(p),r.collapse(!1),r.insertNode(n),r.detach());p=m.createContextualFragment(p);m.insertNode(p);n&&(n=this.contain.querySelectorAll("._wysihtml5-temp-placeholder"),m.setStartBefore(n[0]),m.setEndAfter(n[n.length-1]));this.setSelection(m);try{d(m.startContainer,m.endContainer)}catch(v){setTimeout(function(){throw v;}, 0)}if((n=this.contain.querySelectorAll("._wysihtml5-temp-placeholder"))&&n.length)for(m=rangy.createRange(this.doc),p=n[0].nextSibling,1<n.length&&(q=n[n.length-1].previousSibling),q&&p?m.setStartBefore(p):(q=this.doc.createTextNode(a.INVISIBLE_SPACE),g.insert(q).after(n[0]),m.setStartBefore(q)),m.setEndAfter(q),this.setSelection(m),q=n.length;q--;)n[q].parentNode.removeChild(n[q]);else this.contain.focus();b&&(f.scrollTop=e,f.scrollLeft=l);try{n.parentNode.removeChild(n)}catch(t){}}else d(f,f)}, set:function(a,b){var f=rangy.createRange(this.doc);f.setStart(a,b||0);this.setSelection(f)},insertHTML:function(a){rangy.createRange(this.doc);var b=this.doc.createElement("DIV"),f=this.doc.createDocumentFragment();b.innerHTML=a;for(a=b.lastChild;b.firstChild;)f.appendChild(b.firstChild);this.insertNode(f);a&&this.setAfter(a)},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},splitElementAtCaret:function(a,b){var f=this.getSelection(),e,g;0<f.rangeCount&&(f=f.getRangeAt(0).cloneRange(), f.setEndAfter(a),e=f.extractContents(),a.parentNode.insertBefore(e,a.nextSibling),e=b.firstChild,g=b.lastChild,a.parentNode.insertBefore(b,a.nextSibling),e&&g&&(f.setStartBefore(e),f.setEndAfter(g),this.setSelection(f)))},surround:function(a){var b=this.getOwnRanges(),f,e=[];if(0==b.length)return e;for(var g=b.length;g--;){f=this.doc.createElement(a.nodeName);e.push(f);a.className&&(f.className=a.className);a.cssStyle&&f.setAttribute("style",a.cssStyle);try{b[g].surroundContents(f),this.selectNode(f)}catch(p){f.appendChild(b[g].extractContents()), b[g].insertNode(f)}}return e},deblockAndSurround:function(d){var b=this.doc.createElement("div"),f=rangy.createRange(this.doc),e;b.className=d.className;this.composer.commands.exec("formatBlock",d);e=this.contain.querySelectorAll("."+d.className);if(e[0])for(e[0].parentNode.insertBefore(b,e[0]),f.setStartBefore(e[0]),f.setEndAfter(e[e.length-1]),f=f.extractContents();f.firstChild;)if(e=f.firstChild,1==e.nodeType&&a.dom.hasClass(e,d.className)){for(;e.firstChild;)b.appendChild(e.firstChild);"BR"!== e.nodeName&&b.appendChild(this.doc.createElement("br"));f.removeChild(e)}else b.appendChild(e);else b=null;return b},scrollIntoView:function(){var d=this.doc,b=d.documentElement.scrollHeight>d.documentElement.offsetHeight,f;(f=d._wysihtml5ScrollIntoViewElement)||(f=d.createElement("span"),f.innerHTML=a.INVISIBLE_SPACE);f=d._wysihtml5ScrollIntoViewElement=f;if(b){this.insertNode(f);var b=f,e=0;if(b.parentNode){do e+=b.offsetTop||0,b=b.offsetParent;while(b)}b=e;f.parentNode.removeChild(f);b>=d.body.scrollTop+ d.documentElement.offsetHeight-5&&(d.body.scrollTop=b)}},selectLine:function(){a.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var a=this.doc.defaultView.getSelection();a.modify("move","left","lineboundary");a.modify("extend","right","lineboundary")},toLineBoundary:function(d,b){b="undefined"===typeof b?!1:b;if(a.browser.supportsSelectionModify()){var f=this.doc.defaultView.getSelection();f.modify("extend",d,"lineboundary"); b&&("left"===d?f.collapseToStart():"right"===d&&f.collapseToEnd())}},_selectLine_MSIE:function(){var a=this.doc.selection.createRange(),b=a.boundingTop,f=this.doc.body.scrollWidth,e;if(a.moveToPoint){0===b&&(e=this.doc.createElement("span"),this.insertNode(e),b=e.offsetTop,e.parentNode.removeChild(e));b+=1;for(e=-10;e<f;e+=2)try{a.moveToPoint(e,b);break}catch(g){}for(e=this.doc.selection.createRange();0<=f;f--)try{e.moveToPoint(f,b);break}catch(p){}a.setEndPoint("EndToEnd",e);a.select()}},getText:function(){var a= this.getSelection();return a?a.toString():""},getNodes:function(a,b){var f=this.getRange();return f?f.getNodes(Array.isArray(a)?a:[a],b):[]},fixRangeOverflow:function(a){if(this.contain&&this.contain.firstChild&&a){var b=a.compareNode(this.contain);2!==b?(1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(a)&&(b=a.endContainer.previousElementSibling)&& a.setEnd(b,this._endOffsetForNode(b))}},_endOffsetForNode:function(a){var b=document.createRange();b.selectNodeContents(a);return b.endOffset},_detectInlineRangeProblems:function(a){var b=g.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&b&4},getRange:function(a){var b=this.getSelection(),b=b&&b.rangeCount&&b.getRangeAt(0);!0!==a&&this.fixRangeOverflow(b);return b},getOwnUneditables:function(){var d=g.query(this.contain,"."+this.unselectableClass),b=g.query(d,"."+this.unselectableClass); return a.lang.array(d).without(b)},getOwnRanges:function(){var a=[],b=this.getRange();b&&a.push(b);if(this.unselectableClass&&this.contain&&b){var f=this.getOwnUneditables(),e;if(0<f.length)for(var g=0,p=f.length;g<p;g++)for(var b=[],m=0,n=a.length;m<n;m++){if(a[m])switch(a[m].compareNode(f[g])){case 2:break;case 3:e=a[m].cloneRange();e.setEndBefore(f[g]);b.push(e);e=a[m].cloneRange();e.setStartAfter(f[g]);b.push(e);break;default:b.push(a[m])}a=b}}return a},getSelection:function(){return rangy.getSelection(this.doc.defaultView|| this.doc.parentWindow)},setSelection:function(a){var b=rangy.getSelection(this.doc.defaultView||this.doc.parentWindow);b.setSingleRange(a);return b&&b.anchorNode&&b.focusNode?b:null},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(b){var f=this.getRange(),g=f.commonAncestorContainer, e=f.startContainer,l=f.endContainer;g.nodeType===a.TEXT_NODE&&(g=g.parentNode);if(e.nodeType===a.TEXT_NODE&&!/^\s*$/.test(e.data.substr(f.startOffset))||l.nodeType===a.TEXT_NODE&&!/^\s*$/.test(l.data.substr(f.endOffset)))return!1;for(;e&&e!==g;){if(e.nodeType!==a.TEXT_NODE&&!a.dom.contains(g,e)||a.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;l&&l!==g;){if(l.nodeType!==a.TEXT_NODE&&!a.dom.contains(g,l)||a.dom.domNode(l).next({ignoreBlankTexts:!0}))return!1;l=l.parentNode}return a.lang.array(b).contains(g.nodeName)? g:!1},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})})(wysihtml5); (function(a,f){function b(a,e,b){a.getAttribute("style")?(g(a,b),a.getAttribute("style")&&!/^\s*$/.test(a.getAttribute("style"))?a.setAttribute("style",e+";"+a.getAttribute("style")):a.setAttribute("style",e)):a.setAttribute("style",e)}function g(a,e){var b,d=[];if(a.getAttribute("style")){b=a.getAttribute("style").split(";");for(var f=b.length;f--;)b[f].match(e)||/^\s*$/.test(b[f])||d.push(b[f]);d.length?a.setAttribute("style",d.join(";")):a.removeAttribute("style")}}function d(a,e){var b=[],d=e.split(";"), f=a.getAttribute("style");if(f){f=f.replace(/\s/gi,"").toLowerCase();b.push(new RegExp("(^|\\s|;)"+e.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var g=d.length;0<g--;)/^\s*$/.test(d[g])||b.push(new RegExp("(^|\\s|;)"+d[g].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")); d=0;for(g=b.length;d<g;d++)if(f.match(b[d]))return b[d]}return!1}function k(e,b,g,h){for(var k=e.length;k--;){var l;l=e[k];var p=b,m=h;l=g?d(l,g):m?a.dom.hasClass(l,m):f.dom.arrayContains(p,l.tagName.toLowerCase());if(!l)return!1}return e.length?!0:!1}function h(a,e){return f.dom.isCharacterDataNode(a)?0==e?!!a.previousSibling:e==a.length?!!a.nextSibling:!0:0<e&&e<a.childNodes.length}function e(a,b,d,g){var h;f.dom.isCharacterDataNode(b)&&(0==d?(d=f.dom.getNodeIndex(b),b=b.parentNode):d==b.length? (d=f.dom.getNodeIndex(b)+1,b=b.parentNode):h=f.dom.splitDataNode(b,d));if(!(h||g&&b===g)){h=b.cloneNode(!1);h.id&&h.removeAttribute("id");for(var k;k=b.childNodes[d];)h.appendChild(k);f.dom.insertAfter(h,b)}return b==a?h:e(a,h.parentNode,f.dom.getNodeIndex(h),g)}function l(e){this.firstTextNode=(this.isElementMerge=e.nodeType==a.ELEMENT_NODE)?e.lastChild:e;this.textNodes=[this.firstTextNode]}function p(a,e,b,d,f,g,h){this.tagNames=a||["span"];this.cssClass=e||(!1===e?!1:"");this.similarClassRegExp= b;this.cssStyle=f||"";this.similarStyleRegExp=g;this.normalize=d;this.applyToAnyTagName=!1;this.container=h}var m=/\s+/g;l.prototype={doMerge:function(){for(var a=[],e,b,d=0,f=this.textNodes.length;d<f;++d)e=this.textNodes[d],b=e.parentNode,a[d]=e.data,d&&(b.removeChild(e),b.hasChildNodes()||b.parentNode.removeChild(b));return this.firstTextNode.data=a=a.join("")},getLength:function(){for(var a=this.textNodes.length,e=0;a--;)e+=this.textNodes[a].length;return e},toString:function(){for(var a=[],e= 0,b=this.textNodes.length;e<b;++e)a[e]="'"+this.textNodes[e].data+"'";return"[Merge("+a.join(",")+")]"}};p.prototype={getAncestorWithClass:function(e){for(var b;e;){if(this.cssClass)if(b=this.cssClass,e.className){var d=e.className.match(this.similarClassRegExp)||[];b=d[d.length-1]===b}else b=!1;else b=""!==this.cssStyle?!1:!0;if(e.nodeType==a.ELEMENT_NODE&&"false"!=e.getAttribute("contenteditable")&&f.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&b)return e;e=e.parentNode}return!1},getAncestorWithStyle:function(e){for(var b;e;){if(this.cssStyle){b= e;var d=this.similarStyleRegExp;b.getAttribute&&b.getAttribute("style")?(b.getAttribute("style").match(d),b=b.getAttribute("style").match(d)?!0:!1):b=!1}else b=!1;if(e.nodeType==a.ELEMENT_NODE&&"false"!=e.getAttribute("contenteditable")&&f.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&b)return e;e=e.parentNode}return!1},getMatchingAncestor:function(a){var e=this.getAncestorWithClass(a),b=!1;e?this.cssStyle&&(b="class"):(e=this.getAncestorWithStyle(a))&&(b="style");return{element:e,type:b}}, postApply:function(a,e){for(var b=a[0],d=a[a.length-1],f=[],g,h=b,k=d,p=0,m=d.length,A,G,y=0,H=a.length;y<H;++y)A=a[y],G=null,A&&A.parentNode&&(G=this.getAdjacentMergeableTextNode(A.parentNode,!1)),G?(g||(g=new l(G),f.push(g)),g.textNodes.push(A),A===b&&(h=g.firstTextNode,p=h.length),A===d&&(k=g.firstTextNode,m=g.getLength())):g=null;d&&d.parentNode&&(b=this.getAdjacentMergeableTextNode(d.parentNode,!0))&&(g||(g=new l(d),f.push(g)),g.textNodes.push(b));if(f.length){y=0;for(H=f.length;y<H;++y)f[y].doMerge(); e.setStart(h,p);e.setEnd(k,m)}},getAdjacentMergeableTextNode:function(e,b){var d=e.nodeType==a.TEXT_NODE,f=d?e.parentNode:e,g=b?"nextSibling":"previousSibling";if(d){if((d=e[g])&&d.nodeType==a.TEXT_NODE)return d}else if((d=f[g])&&this.areElementsMergeable(e,d))return d[b?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,e){var b;if(b=f.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&f.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase()))b=a.className.replace(m, " ")==e.className.replace(m," ");if(b)a:if(a.attributes.length!=e.attributes.length)b=!1;else{b=0;for(var d=a.attributes.length,g,h;b<d;++b)if(g=a.attributes[b],h=g.name,"class"!=h&&(h=e.attributes.getNamedItem(h),g.specified!=h.specified||g.specified&&g.nodeValue!==h.nodeValue)){b=!1;break a}b=!0}return b},createContainer:function(a){a=a.createElement(this.tagNames[0]);this.cssClass&&(a.className=this.cssClass);this.cssStyle&&a.setAttribute("style",this.cssStyle);return a},applyToTextNode:function(a){var e= a.parentNode;1==e.childNodes.length&&f.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())?(this.cssClass&&(a=this.cssClass,e.className?(e.className&&(e.className=e.className.replace(this.similarClassRegExp,"")),e.className+=" "+a):e.className=a),this.cssStyle&&b(e,this.cssStyle,this.similarStyleRegExp)):(e=this.createContainer(f.dom.getDocument(a)),a.parentNode.insertBefore(e,a),e.appendChild(a))},isRemovable:function(e){return f.dom.arrayContains(this.tagNames,e.tagName.toLowerCase())&&""=== a.lang.string(e.className).trim()&&(!e.getAttribute("style")||""===a.lang.string(e.getAttribute("style")).trim())},undoToTextNode:function(a,f,k,l){a=k?!1:!0;k=k||l;l=!1;if(!f.containsNode(k)){var p=f.cloneRange();p.selectNode(k);p.isPointInRange(f.endContainer,f.endOffset)&&h(f.endContainer,f.endOffset)&&(e(k,f.endContainer,f.endOffset,this.container),f.setEndAfter(k));p.isPointInRange(f.startContainer,f.startOffset)&&h(f.startContainer,f.startOffset)&&(k=e(k,f.startContainer,f.startOffset,this.container))}!a&& this.similarClassRegExp&&k.className&&(k.className=k.className.replace(this.similarClassRegExp,""));a&&this.similarStyleRegExp&&(f=k,a=this.cssStyle,l=this.similarStyleRegExp,(p=d(f,a))?(g(f,p),f="remove"):(b(f,a,l),f="change"),l="change"===f);if(this.isRemovable(k)&&!l){for(f=k.parentNode;k.firstChild;)f.insertBefore(k.firstChild,k);f.removeChild(k)}},applyToRange:function(e){for(var b,d=e.length;d--;){b=e[d].getNodes([a.TEXT_NODE]);if(!b.length)try{var f=this.createContainer(e[d].endContainer.ownerDocument); e[d].surroundContents(f);this.selectNode(e[d],f);break}catch(g){}e[d].splitBoundaries();b=e[d].getNodes([a.TEXT_NODE]);if(b.length){for(var h,k=0,l=b.length;k<l;++k)h=b[k],this.getMatchingAncestor(h).element||this.applyToTextNode(h);e[d].setStart(b[0],0);h=b[b.length-1];e[d].setEnd(h,h.length);this.normalize&&this.postApply(b,e[d])}}},undoToRange:function(e){for(var b,d,f,g=e.length;g--;){b=e[g].getNodes([a.TEXT_NODE]);b.length?(e[g].splitBoundaries(),b=e[g].getNodes([a.TEXT_NODE])):(b=e[g].endContainer.ownerDocument.createTextNode(a.INVISIBLE_SPACE), e[g].insertNode(b),e[g].selectNode(b),b=[b]);for(var h=0,k=b.length;h<k;++h)e[g].isValid()&&(d=b[h],f=this.getMatchingAncestor(d),"style"===f.type?this.undoToTextNode(d,e[g],!1,f.element):f.element&&this.undoToTextNode(d,e[g],f.element));1==k?this.selectNode(e[g],b[0]):(e[g].setStart(b[0],0),d=b[b.length-1],e[g].setEnd(d,d.length),this.normalize&&this.postApply(b,e[g]))}},selectNode:function(e,b){var d=b.nodeType===a.ELEMENT_NODE,f="canHaveHTML"in b?b.canHaveHTML:!0,g=d?b.innerHTML:b.data;if((g=""=== g||g===a.INVISIBLE_SPACE)&&d&&f)try{b.innerHTML=a.INVISIBLE_SPACE}catch(h){}e.selectNodeContents(b);g&&d?e.collapse(!1):g&&(e.setStartAfter(b),e.setEndAfter(b))},getTextSelectedByRange:function(a,e){var b=e.cloneRange();b.selectNodeContents(a);var d=b.intersection(e),d=d?d.toString():"";b.detach();return d},isAppliedToRange:function(e){for(var b=[],d="full",f,g,h=e.length;h--;){g=e[h].getNodes([a.TEXT_NODE]);if(!g.length)return(f=this.getMatchingAncestor(e[h].startContainer).element)?{elements:[f], coverage:d}:!1;for(var k=0,l=g.length,p;k<l;++k)p=this.getTextSelectedByRange(g[k],e[h]),(f=this.getMatchingAncestor(g[k]).element)&&""!=p?(b.push(f),1===a.dom.getTextNodes(f,!0).length?d="full":"full"===d&&(d="inline")):f||(d="partial")}return b.length?{elements:b,coverage:d}:!1},toggleRange:function(a){var e=this.isAppliedToRange(a);e?"full"===e.coverage?this.undoToRange(a):"inline"===e.coverage?(e=k(e.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(a),e||this.applyToRange(a)): (k(e.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(a),this.applyToRange(a)):this.applyToRange(a)}};a.selection.HTMLApplier=p})(wysihtml5,rangy); wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(a,f){var b=wysihtml5.commands[a],g=wysihtml5.lang.array(arguments).get(),d=b&&b.exec,k=null;this.composer.hasPlaceholderSet()&&!wysihtml5.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(a)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)); this.editor.fire("beforecommand:composer");if(d)g.unshift(this.composer),k=d.apply(b,g);else try{k=this.doc.execCommand(a,!1,f)}catch(h){}this.editor.fire("aftercommand:composer");return k},state:function(a,f){var b=wysihtml5.commands[a],g=wysihtml5.lang.array(arguments).get(),d=b&&b.state;if(d)return g.unshift(this.composer),d.apply(b,g);try{return this.doc.queryCommandState(a)}catch(k){return!1}},stateValue:function(a){var f=wysihtml5.commands[a],b=wysihtml5.lang.array(arguments).get(),g=f&&f.stateValue; return g?(b.unshift(this.composer),g.apply(f,b)):!1}});wysihtml5.commands.bold={exec:function(a,f){wysihtml5.commands.formatInline.execWithToggle(a,f,"b")},state:function(a,f){return wysihtml5.commands.formatInline.state(a,f,"b")}}; (function(a){function f(d,f){var h=d.doc,e="_wysihtml5-temp-"+ +new Date,l=0,p,m,n;a.commands.formatInline.exec(d,b,"A",e,/non-matching-class/g,b,b,!0,!0);p=h.querySelectorAll("A."+e);for(e=p.length;l<e;l++)for(n in m=p[l],m.removeAttribute("class"),f)"text"!==n&&m.setAttribute(n,f[n]);l=m;1===e&&(n=g.getTextContent(m),e=!!m.querySelector("*"),n=""===n||n===a.INVISIBLE_SPACE,!e&&n&&(g.setTextContent(m,f.text||m.href),h=h.createTextNode(" "),d.selection.setAfter(m),g.insert(h).after(m),l=h));d.selection.setAfter(l)} var b,g=a.dom;a.commands.createLink={exec:function(b,g,h){var e=this.state(b,g);if(e)if(!(h&&h.href||null===e.length)&&void 0!==e.length&&0<e.length)for(b=0;b<e.length;b++)a.dom.unwrap(e[b]);else b.selection.executeAndRestore(function(){for(var a=h,b,d=e.length;d--;){b=e[d].attributes;for(var f=b.length;f--;)e[d].removeAttribute(b.item(f).name);for(var g in a)a.hasOwnProperty(g)&&e[d].setAttribute(g,a[g])}});else h&&h.href&&(h="object"===typeof h?h:{href:h},f(b,h))},state:function(b,f){return a.commands.formatInline.state(b, f,"a")}}})(wysihtml5);(function(a){var f=a.dom;a.commands.removeLink={exec:function(a,g){var d=this.state(a,g);d&&a.selection.executeAndRestore(function(){for(var a=d.length,b=0,e,g,p;b<a;b++)e=d[b],g=f.getParentElement(e,{query:"code"}),p=f.getTextContent(e),p.match(f.autoLink.URL_REG_EXP)&&!g?f.renameElement(e,"code"):f.replaceWithChildNodes(e)})},state:function(b,f){return a.commands.formatInline.state(b,f,"A")}}})(wysihtml5); (function(a){var f=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(b,g,d){a.commands.formatInline.execWithToggle(b,g,"span","wysiwyg-font-size-"+d,f)},state:function(b,g,d){return a.commands.formatInline.state(b,g,"span","wysiwyg-font-size-"+d,f)}}})(wysihtml5); (function(a){var f=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;a.commands.fontSizeStyle={exec:function(b,g,d){d="object"==typeof d?d.size:d;/^\s*$/.test(d)||a.commands.formatInline.execWithToggle(b,g,"span",!1,!1,"font-size:"+d,f)},state:function(b,g,d){return a.commands.formatInline.state(b,g,"span",!1,!1,"font-size",f)},stateValue:function(b,f){var d=this.state(b,f);d&&a.lang.object(d).isArray()&&(d=d[0]);return d&&(d=d.getAttribute("style"))?a.quirks.styleParser.parseFontSize(d):!1}}})(wysihtml5); (function(a){var f=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(b,g,d){a.commands.formatInline.execWithToggle(b,g,"span","wysiwyg-color-"+d,f)},state:function(b,g,d){return a.commands.formatInline.state(b,g,"span","wysiwyg-color-"+d,f)}}})(wysihtml5); (function(a){var f=/(\s|^)color\s*:\s*[^;\s]+;?/gi;a.commands.foreColorStyle={exec:function(b,g,d){d=a.quirks.styleParser.parseColor("object"==typeof d?"color:"+d.color:"color:"+d,"color");var k;d&&(k="color: rgb("+d[0]+","+d[1]+","+d[2]+");",1!==d[3]&&(k+="color: rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+");"),a.commands.formatInline.execWithToggle(b,g,"span",!1,!1,k,f))},state:function(b,g){return a.commands.formatInline.state(b,g,"span",!1,!1,"color",f)},stateValue:function(b,f,d){(b=this.state(b, f))&&a.lang.object(b).isArray()&&(b=b[0]);return b&&(b=b.getAttribute("style"))&&b?(val=a.quirks.styleParser.parseColor(b,"color"),a.quirks.styleParser.unparseColor(val,d)):!1}}})(wysihtml5); (function(a){var f=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;a.commands.bgColorStyle={exec:function(b,g,d){d=a.quirks.styleParser.parseColor("object"==typeof d?"background-color:"+d.color:"background-color:"+d,"background-color");var k;d&&(k="background-color: rgb("+d[0]+","+d[1]+","+d[2]+");",1!==d[3]&&(k+="background-color: rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+");"),a.commands.formatInline.execWithToggle(b,g,"span",!1,!1,k,f))},state:function(b,g){return a.commands.formatInline.state(b,g,"span", !1,!1,"background-color",f)},stateValue:function(b,f,d){b=this.state(b,f);f=!1;b&&a.lang.object(b).isArray()&&(b=b[0]);return b&&(b=b.getAttribute("style"))?(f=a.quirks.styleParser.parseColor(b,"background-color"),a.quirks.styleParser.unparseColor(f,d)):!1}}})(wysihtml5); (function(a){function f(b,e,d){b||(b=d.doc.createElement(e.nodeName||(d.config.useLineBreaks?"DIV":"P")),b.appendChild(d.doc.createTextNode(a.INVISIBLE_SPACE)));e.nodeName&&b.nodeName!==e.nodeName&&(b=k.renameElement(b,e.nodeName));e.classRegExp&&(b.className=b.className.replace(e.classRegExp,""));e.className&&b.classList.add(e.className);e.styleProperty&&"undefined"!==typeof e.styleValue&&(b.style[a.browser.fixStyleKey(e.styleProperty)]=e.styleValue);return b}function b(b){b=b.querySelectorAll(BLOCK_ELEMENTS)|| [];for(var e=b.length;e--;)b[e].nextSibling&&1===b[e].nextSibling.nodeType&&"BR"===b[e].nextSibling.nodeName||""!==(b[e].innerHTML||b[e].nodeValue).trim()&&b[e].parentNode.insertBefore(b[e].ownerDocument.createElement("BR"),b[e].nextSibling),a.dom.unwrap(b[e])}function g(d,e,g,k){var m=e?a.lang.object(e).clone(!0):null;m&&(m.nodeName=m.nodeName||g||(k.config.useLineBreaks?"DIV":"P"));var n;d.startContainer&&1===d.startContainer.nodeType&&d.startContainer===d.endContainer?d.startContainer.firstChild=== d.startContainer.lastChild&&1===d.endOffset&&d.startContainer!==k.element&&(d.setStartBefore(d.startContainer),d.setEndAfter(d.endContainer)):d.startContainer&&1===d.startContainer.nodeType&&3===d.endContainer.nodeType?d.startContainer.firstChild===d.endContainer&&1===d.endOffset&&d.startContainer!==k.element&&d.setEndAfter(d.startContainer):d.endContainer&&1===d.endContainer.nodeType&&3===d.startContainer.nodeType?d.endContainer.firstChild===d.startContainer&&1===d.endOffset&&d.endContainer!==k.element&& d.setStartBefore(d.endContainer):d.startContainer&&3===d.startContainer.nodeType&&d.startContainer===d.endContainer&&d.startContainer.parentNode&&d.startContainer.parentNode.firstChild===d.startContainer&&d.endOffset==d.endContainer.length&&0===d.startOffset&&(n=d.startContainer.parentNode,n!==k.element&&(d.setStartBefore(n),d.setEndAfter(n)));d=d.cloneRange();var q=d.startContainer,r=d.extractContents();n=k.doc.createDocumentFragment();var v;v=k.element;g=!m||"BLOCKQUOTE"===g&&m.nodeName&&"BLOCKQUOTE"=== m.nodeName;for(var t=null;q&&v&&q!==v;)1===q.nodeType&&q.matches(g?BLOCK_ELEMENTS:"h1, h2, h3, h4, h5, h6, p, pre")&&(t=q),q=q.parentNode;v=t;if(e&&e.nodeName&&"BLOCKQUOTE"===e.nodeName)e=f(null,e,k),e.appendChild(r),n.appendChild(e),e=[e];else{if(r.firstChild)for(;r.firstChild;)if(r.firstChild.matches=Element.prototype.matches,1==r.firstChild.nodeType&&r.firstChild.matches(BLOCK_ELEMENTS))if(e)f(r.firstChild,e,k),r.firstChild.matches=Element.prototype.matches,r.firstChild.matches("h1, h2, h3, h4, h5, h6, p, pre")&& b(r.firstChild),n.appendChild(r.firstChild);else{b(r.firstChild);g=a.dom.unwrap(r.firstChild);q=0;for(t=g.length;q<t;q++)n.appendChild(g[q]);0<n.childNodes.length&&n.appendChild(k.doc.createElement("BR"))}else if(e){g=f(null,m,k);for(r.firstChild.matches=Element.prototype.matches;r.firstChild&&(1!==r.firstChild.nodeType||!r.firstChild.matches(BLOCK_ELEMENTS));)g.matches=Element.prototype.matches,1==r.firstChild.nodeType&&g.matches("h1, h2, h3, h4, h5, h6, p, pre")&&b(r.firstChild),g.appendChild(r.firstChild), r.firstChild&&(r.firstChild.matches=Element.prototype.matches);n.appendChild(g)}else 1==r.firstChild.nodeType&&b(r.firstChild),n.appendChild(r.firstChild);else n.appendChild(f(null,e,k));e=a.lang.array(n.childNodes).get()}v?k.selection.splitElementAtCaret(v,n):d.insertNode(n);return e}function d(b,e){var d=a.dom.getParentElement(b,{query:BLOCK_ELEMENTS},null,e.element);return d?d.nodeName:null}var k=a.dom;BLOCK_ELEMENTS="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote";a.commands.formatBlock={exec:function(b, e,f){var p=[],m,n,q;"string"===typeof f&&(f={nodeName:f.toUpperCase()});if(f&&f.toggle&&(m=this.state(b,e,f)))for(n in q=rangy.saveSelection(b.doc.defaultView||b.doc.parentWindow),m){e=m[n];var r=f,v=b,t=void 0;r.styleProperty&&(e.style[a.browser.fixStyleKey(r.styleProperty)]="");r.className&&e.classList.remove(r.className);r.classRegExp&&(e.className=e.className.replace(r.classRegExp,""));null!==e.getAttribute("class")&&""===e.getAttribute("class").trim()&&e.removeAttribute("class");r.nodeName&& e.nodeName===r.nodeName&&((t=e.getAttribute("style"))&&""!==t.trim()?e=k.renameElement(e,v.config.useLineBreaks?"DIV":"P"):k.unwrap(e));null!==e.getAttribute("style")&&""===e.getAttribute("style").trim()&&e.removeAttribute("style")}if(!m)for(b.selection.isCollapsed()&&((n=a.dom.getParentElement(b.selection.getOwnRanges()[0].startContainer,{query:BLOCK_ELEMENTS},null,b.element))?(q=rangy.saveSelection(b.doc.defaultView||b.doc.parentWindow),m=b.selection.createRange(),m.selectNode(n),b.selection.setSelection(m)): b.isEmpty()||(q=rangy.saveSelection(b.doc.defaultView||b.doc.parentWindow),b.selection.selectLine())),m=b.selection.getOwnRanges(),n=m.length;n--;)p=p.concat(g(m[n],f,d(m[n].startContainer,b),b));m=b.element;f=m.querySelectorAll(BLOCK_ELEMENTS);m=m.querySelectorAll(b.config.uneditableContainerClassname);f=a.lang.array(f).without(m);for(m=f.length;m--;)""===f[m].innerHTML&&f[m].parentNode.removeChild(f[m]);q?rangy.restoreSelection(q):(m=b.selection.createRange(),m.setStartBefore(p[0]),m.setEndAfter(p[p.length- 1]),b.selection.setSelection(m));a.dom.removeInvisibleSpaces(b.element)},state:function(b,e,d){"string"===typeof d&&(d={query:d});e=b.selection.filterElements(function(b){return a.dom.domNode(b).test(d||{query:BLOCK_ELEMENTS})}.bind(this));for(var f=b.selection.getSelectedOwnNodes(),g,n=0,q=f.length;n<q;n++)(g=k.getParentElement(f[n],d||{query:BLOCK_ELEMENTS},null,b.element))&&-1===e.indexOf(g)&&e.push(g);return 0===e.length?!1:e}}})(wysihtml5); wysihtml5.commands.formatCode={exec:function(a,f,b){var g=this.state(a),d,k;g?a.selection.executeAndRestore(function(){d=g.querySelector("code");wysihtml5.dom.replaceWithChildNodes(g);d&&wysihtml5.dom.replaceWithChildNodes(d)}):(f=a.selection.getRange(),k=f.extractContents(),g=a.doc.createElement("pre"),d=a.doc.createElement("code"),b&&(d.className=b),g.appendChild(d),d.appendChild(k),f.insertNode(g),a.selection.selectNode(g))},state:function(a){return(a=a.selection.getSelectedNode())&&a.nodeName&& "PRE"==a.nodeName&&a.firstChild&&a.firstChild.nodeName&&"CODE"==a.firstChild.nodeName?a:wysihtml5.dom.getParentElement(a,{query:"pre code"})}}; (function(a){function f(d,f,h,e,l,p){var m=d;f&&(m+=":"+f);e&&(m+=":"+e);if(!g[m]){var n=m,q=a.selection.HTMLApplier,r=b[d];d=r?[d.toLowerCase(),r.toLowerCase()]:[d.toLowerCase()];g[n]=new q(d,f,h,!0,e,l,p)}return g[m]}var b={strong:"b",em:"i",b:"strong",i:"em"},g={};a.commands.formatInline={exec:function(a,b,g,e,l,p,m,n,q){b=a.selection.createRange();var r=a.selection.getOwnRanges();if(!r||0==r.length)return!1;a.selection.getSelection().removeAllRanges();f(g,e,l,p,m,a.element).toggleRange(r);n?q|| a.cleanUp():(b.setStart(r[0].startContainer,r[0].startOffset),b.setEnd(r[r.length-1].endContainer,r[r.length-1].endOffset),a.selection.setSelection(b),a.selection.executeAndRestore(function(){q||a.cleanUp()},!0,!0))},execWithToggle:function(b,f,g,e,l,p,m){if(this.state(b,f,g,e,l,p,m)&&b.selection.isCollapsed()&&!b.selection.caretIsLastInSelection()&&!b.selection.caretIsFirstInSelection()){var n=this.state(b,f,g,e,l)[0];b.selection.executeAndRestoreRangy(function(){b.selection.selectNode(n,!0);a.commands.formatInline.exec(b, f,g,e,l,p,m,!0,!0)})}else this.state(b,f,g,e,l,p,m)&&!b.selection.isCollapsed()?b.selection.executeAndRestoreRangy(function(){a.commands.formatInline.exec(b,f,g,e,l,p,m,!0,!0)}):a.commands.formatInline.exec(b,f,g,e,l,p,m)},state:function(d,g,h,e,l,p,m){g=d.doc;var n=b[h]||h;if(!a.dom.hasElementWithTagName(g,h)&&!a.dom.hasElementWithTagName(g,n)||e&&!a.dom.hasElementWithClassName(g,e))return!1;g=d.selection.getOwnRanges();return g&&0!==g.length?(d=f(h,e,l,p,m,d.element).isAppliedToRange(g))&&d.elements? d.elements:!1:!1}}})(wysihtml5);(function(a){var f={nodeName:"BLOCKQUOTE",toggle:!0};a.commands.insertBlockQuote={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5);wysihtml5.commands.insertHTML={exec:function(a,f,b){a.commands.support(f)?a.doc.execCommand(f,!1,b):a.selection.insertHTML(b)},state:function(){return!1}}; (function(a){a.commands.insertImage={exec:function(f,b,g){g="object"===typeof g?g:{src:g};var d=f.doc;if((b=this.state(f))&&!g.src)f.selection.setBefore(b),g=b.parentNode,g.removeChild(b),a.dom.removeEmptyTextNodes(g),"A"!==g.nodeName||g.firstChild||(f.selection.setAfter(g),g.parentNode.removeChild(g)),a.quirks.redraw(f.element);else if(b)for(var k in g)g.hasOwnProperty(k)&&b.setAttribute("className"===k?"class":k,g[k]);else{b=d.createElement("IMG");for(var h in g)b.setAttribute("className"===h?"class": h,g[h]);f.selection.insertNode(b);a.browser.hasProblemsSettingCaretAfterImg()?(g=d.createTextNode(a.INVISIBLE_SPACE),f.selection.insertNode(g),f.selection.setAfter(g)):f.selection.setAfter(b)}},state:function(f){var b;if(!a.dom.hasElementWithTagName(f.doc,"IMG"))return!1;b=f.selection.getSelectedNode();if(!b)return!1;if("IMG"===b.nodeName)return b;if(b.nodeType!==a.ELEMENT_NODE)return!1;b=f.selection.getText();if(b=a.lang.string(b).trim())return!1;f=f.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"=== a.nodeName});return 1!==f.length?!1:f[0]}}})(wysihtml5);(function(a){var f="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(b,g){b.commands.support(g)?(b.doc.execCommand(g,!1,null),a.browser.autoScrollsToCaret()||b.selection.scrollIntoView()):b.commands.exec("insertHTML",f)},state:function(){return!1}}})(wysihtml5); wysihtml5.commands.insertOrderedList={exec:function(a,f){wysihtml5.commands.insertList.exec(a,f,"OL")},state:function(a,f){return wysihtml5.commands.insertList.state(a,f,"OL")}};wysihtml5.commands.insertUnorderedList={exec:function(a,f){wysihtml5.commands.insertList.exec(a,f,"UL")},state:function(a,f){return wysihtml5.commands.insertList.state(a,f,"UL")}}; wysihtml5.commands.insertList=function(a){var f=function(a,b){if(a&&a.nodeName){"string"===typeof b&&(b=[b]);for(var d=b.length;d--;)if(a.nodeName===b[d])return!0}return!1},b=function(b,d,g){var h={el:null,other:!1};if(b){var k=a.dom.getParentElement(b,{query:"li"}),q="UL"===d?"OL":"UL";f(b,d)?h.el=b:f(b,q)?h={el:b,other:!0}:k&&(f(k.parentNode,d)?h.el=k.parentNode:f(k.parentNode,q)&&(h={el:k.parentNode,other:!0}))}h.el&&!g.element.contains(h.el)&&(h.el=null);return h},g=function(b,d,f){var g="UL"=== d?"OL":"UL",h;f.selection.executeAndRestore(function(){var q=k(g,f);if(q.length)for(var r=q.length;r--;)a.dom.renameElement(q[r],d.toLowerCase());else{h=k(["OL","UL"],f);for(q=h.length;q--;)a.dom.resolveList(h[q],f.config.useLineBreaks);a.dom.resolveList(b,f.config.useLineBreaks)}})},d=function(b,d,f){var g="UL"===d?"OL":"UL";f.selection.executeAndRestore(function(){for(var h=[b].concat(k(g,f)),q=h.length;q--;)a.dom.renameElement(h[q],d.toLowerCase())})},k=function(a,b){for(var d=b.selection.getOwnRanges(), g=[],h=d.length;h--;)g=g.concat(d[h].getNodes([1],function(b){return f(b,a)}));return g},h=function(b,d){d.selection.executeAndRestoreRangy(function(){var f="_wysihtml5-temp-"+(new Date).getTime(),g=d.selection.deblockAndSurround({nodeName:"div",className:f});g.innerHTML=g.innerHTML.replace(a.INVISIBLE_SPACE_REG_EXP,"");g&&(f=a.lang.array(["","<br>",a.INVISIBLE_SPACE]).contains(g.innerHTML),g=a.dom.convertToList(g,b.toLowerCase(),d.parent.config.uneditableContainerClassname),f&&d.selection.selectNode(g.querySelector("li"), !0))})};return{exec:function(a,f,k){f=a.doc;var m="OL"===k?"insertOrderedList":"insertUnorderedList",n=a.selection.getSelectedNode(),n=b(n,k,a);n.el?n.other?d(n.el,k,a):g(n.el,k,a):a.commands.support(m)?f.execCommand(m,!1,null):h(k,a)},state:function(a,d,f){d=a.selection.getSelectedNode();a=b(d,f,a);return a.el&&!a.other?a.el:!1}}}(wysihtml5); wysihtml5.commands.italic={exec:function(a,f){wysihtml5.commands.formatInline.execWithToggle(a,f,"i")},state:function(a,f){return wysihtml5.commands.formatInline.state(a,f,"i")}};(function(a){var f={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyCenter={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyLeft={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyRight={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};a.commands.justifyFull={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={styleProperty:"textAlign",styleValue:"right",toggle:!0};a.commands.alignRightStyle={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={styleProperty:"textAlign",styleValue:"left",toggle:!0};a.commands.alignLeftStyle={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5); (function(a){var f={styleProperty:"textAlign",styleValue:"center",toggle:!0};a.commands.alignCenterStyle={exec:function(b,g){return a.commands.formatBlock.exec(b,"formatBlock",f)},state:function(b,g){return a.commands.formatBlock.state(b,"formatBlock",f)}}})(wysihtml5);wysihtml5.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}}; wysihtml5.commands.underline={exec:function(a,f){wysihtml5.commands.formatInline.execWithToggle(a,f,"u")},state:function(a,f){return wysihtml5.commands.formatInline.state(a,f,"u")}};wysihtml5.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}}; wysihtml5.commands.createTable={exec:function(a,f,b){var g,d;if(b&&b.cols&&b.rows&&0<parseInt(b.cols,10)&&0<parseInt(b.rows,10)){d=b.tableStyle?'<table style="'+b.tableStyle+'">':"<table>";d+="<tbody>";for(g=0;g<b.rows;g++){d+="<tr>";for(f=0;f<b.cols;f++)d+="<td>&nbsp;</td>";d+="</tr>"}a.commands.exec("insertHTML",d+"</tbody></table>")}},state:function(a,f){return!1}}; wysihtml5.commands.mergeTableCells={exec:function(a,f){a.tableSelection&&a.tableSelection.start&&a.tableSelection.end&&(this.state(a,f)?wysihtml5.dom.table.unmergeCell(a.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(a.tableSelection.start,a.tableSelection.end))},state:function(a,f){if(a.tableSelection){var b=a.tableSelection.start,g=a.tableSelection.end;if(b&&g&&b==g&&(wysihtml5.dom.getAttribute(b,"colspan")&&1<parseInt(wysihtml5.dom.getAttribute(b,"colspan"),10)||wysihtml5.dom.getAttribute(b, "rowspan")&&1<parseInt(wysihtml5.dom.getAttribute(b,"rowspan"),10)))return[b]}return!1}}; wysihtml5.commands.addTableCells={exec:function(a,f,b){if(a.tableSelection&&a.tableSelection.start&&a.tableSelection.end){var g=wysihtml5.dom.table.orderSelectionEnds(a.tableSelection.start,a.tableSelection.end);"before"==b||"above"==b?wysihtml5.dom.table.addCells(g.start,b):"after"!=b&&"below"!=b||wysihtml5.dom.table.addCells(g.end,b);setTimeout(function(){a.tableSelection.select(g.start,g.end)},0)}},state:function(a,f){return!1}}; wysihtml5.commands.deleteTableCells={exec:function(a,f,b){if(a.tableSelection&&a.tableSelection.start&&a.tableSelection.end){f=wysihtml5.dom.table.orderSelectionEnds(a.tableSelection.start,a.tableSelection.end);var g=wysihtml5.dom.table.indexOf(f.start),d,k=a.tableSelection.table;wysihtml5.dom.table.removeCells(f.start,b);setTimeout(function(){d=wysihtml5.dom.table.findCell(k,g);d||("row"==b&&(d=wysihtml5.dom.table.findCell(k,{row:g.row-1,col:g.col})),"column"==b&&(d=wysihtml5.dom.table.findCell(k, {row:g.row,col:g.col-1})));d&&a.tableSelection.select(d,d)},0)}},state:function(a,f){return!1}}; wysihtml5.commands.indentList={exec:function(a,f,b){return(f=a.selection.getSelectionParentsByTag("LI"))?this.tryToPushLiLevel(f,a.selection):!1},state:function(a,f){return!1},tryToPushLiLevel:function(a,f){var b,g,d,k,h,e=!1;f.executeAndRestoreRangy(function(){for(var f=a.length;f--;)k=a[f],b="OL"===k.parentNode.nodeName?"OL":"UL",g=k.ownerDocument.createElement(b),h=(d=wysihtml5.dom.domNode(k).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}))?d.querySelector("ul, ol"):null,d&&(h?h.appendChild(k):(g.appendChild(k), d.appendChild(g)),e=!0)});return e}}; wysihtml5.commands.outdentList={exec:function(a,f,b){return(f=a.selection.getSelectionParentsByTag("LI"))?this.tryToPullLiLevel(f,a):!1},state:function(a,f){return!1},tryToPullLiLevel:function(a,f){var b,g,d,k,h,e=!1,l=this;f.selection.executeAndRestoreRangy(function(){for(var p=a.length;p--;)if(k=a[p],k.parentNode&&(b=k.parentNode,"OL"===b.tagName||"UL"===b.tagName)){e=!0;g=wysihtml5.dom.getParentElement(b.parentNode,{query:"ol, ul"},!1,f.element);d=wysihtml5.dom.getParentElement(b.parentNode,{query:"li"}, !1,f.element);if(g&&d)k.nextSibling&&(h=l.getAfterList(b,k),k.appendChild(h)),g.insertBefore(k,d.nextSibling);else{k.nextSibling&&(h=l.getAfterList(b,k),k.appendChild(h));for(var m=k.childNodes.length;m--;)b.parentNode.insertBefore(k.childNodes[m],b.nextSibling);b.parentNode.insertBefore(document.createElement("br"),b.nextSibling);k.parentNode.removeChild(k)}0===b.childNodes.length&&b.parentNode.removeChild(b)}});return e},getAfterList:function(a,f){for(var b=document.createElement(a.nodeName);f.nextSibling;)b.appendChild(f.nextSibling); return b}};wysihtml5.commands.subscript={exec:function(a,f){wysihtml5.commands.formatInline.execWithToggle(a,f,"sub")},state:function(a,f){return wysihtml5.commands.formatInline.state(a,f,"sub")}};wysihtml5.commands.superscript={exec:function(a,f){wysihtml5.commands.formatInline.execWithToggle(a,f,"sup")},state:function(a,f){return wysihtml5.commands.formatInline.state(a,f,"sup")}}; (function(a){var f=a.dom;a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var a=this;this.composer.sandbox.getDocument();var g;f.observe(this.element,"keydown",function(d){if(!d.altKey&&(d.ctrlKey||d.metaKey)){var f=d.keyCode,g=90===f&&d.shiftKey||89===f;90!==f||d.shiftKey?g&&(a.redo(),d.preventDefault()): (a.undo(),d.preventDefault())}});f.observe(this.element,"keydown",function(d){d=d.keyCode;d!==g&&(g=d,8!==d&&46!==d||a.transact())});this.editor.on("newword:composer",function(){a.transact()}).on("beforecommand:composer",function(){a.transact()})},transact:function(){var b=this.historyStr[this.position-1],f=this.composer.getValue(!1,!1),d=0<this.element.offsetWidth&&0<this.element.offsetHeight,k,h;f!==b&&(25<(this.historyStr.length=this.historyDom.length=this.position)&&(this.historyStr.shift(),this.historyDom.shift(), this.position--),this.position++,d&&(b=(k=this.composer.selection.getRange())&&k.startContainer?k.startContainer:this.element,d=k&&k.startOffset?k.startOffset:0,b.nodeType===a.ELEMENT_NODE?k=b:(k=b.parentNode,h=this.getChildNodeIndex(k,b)),k.setAttribute("data-wysihtml5-selection-offset",d),"undefined"!==typeof h&&k.setAttribute("data-wysihtml5-selection-node",h)),h=this.element.cloneNode(!!f),this.historyDom.push(h),this.historyStr.push(f),k&&(k.removeAttribute("data-wysihtml5-selection-offset"), k.removeAttribute("data-wysihtml5-selection-node")))},undo:function(){this.transact();this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var f=0,d=a.childNodes,k=a.childNodes.length;f< k;f++)this.element.appendChild(d[f].cloneNode(!0));a.hasAttribute("data-wysihtml5-selection-offset")?(f=a.getAttribute("data-wysihtml5-selection-offset"),d=a.getAttribute("data-wysihtml5-selection-node"),a=this.element):(a=this.element.querySelector("[data-wysihtml5-selection-offset]")||this.element,f=a.getAttribute("data-wysihtml5-selection-offset"),d=a.getAttribute("data-wysihtml5-selection-node"),a.removeAttribute("data-wysihtml5-selection-offset"),a.removeAttribute("data-wysihtml5-selection-node")); null!==d&&(a=this.getChildNodeByIndex(a,+d));this.composer.selection.set(a,f)},getChildNodeIndex:function(a,f){for(var d=0,k=a.childNodes,h=k.length;d<h;d++)if(k[d]===f)return d},getChildNodeByIndex:function(a,f){return a.childNodes[f]}})})(wysihtml5); wysihtml5.views.View=Base.extend({constructor:function(a,f,b){this.parent=a;this.element=f;this.config=b;this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(f){f===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&& this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}); (function(a){var f=a.dom,b=a.browser;a.views.Composer=a.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(a,b,f){this.base(a,b,f);this.config.noTextarea?this.editableArea=b:this.textarea=this.parent.textarea;this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=b.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b,d){var f=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element); !1!==b&&(f=this.parent.parse(f,!1===d?!1:!0));return f},setValue:function(a,b){b&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(f){this.element.innerText=a}},cleanUp:function(){var a;this.selection&&(a=rangy.saveSelection(this.doc.defaultView||this.doc.parentWindow));this.parent.parse(this.element);a&&rangy.restoreSelection(a)},show:function(){this.editableArea.style.display=this._displayStyle||"";this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())}, hide:function(){this._displayStyle=f.getStyle("display").from(this.editableArea);"none"===this._displayStyle&&(this._displayStyle=null);this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(b){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var d=this.element.lastChild; b&&d&&this.selection&&("BR"===d.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return f.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)|| ""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new f.ContentEditableArea(function(){a._create()},{},this.editableArea):(this.sandbox=new f.ContentEditableArea(function(){a._create()}),this.editableArea=this.sandbox.getContentEditable(),f.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a=this;this.sandbox=new f.Sandbox(function(){a._create()}, {stylesheets:this.config.stylesheets});this.editableArea=this.sandbox.getIframe();var b=this.textarea.element;f.insert(this.editableArea).after(b);this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden";a.name="_wysihtml5_mode";a.value=1;f.insert(a).after(this.textarea.element)}},_create:function(){var g=this;this.doc=this.sandbox.getDocument();this.element=this.config.contentEditableMode?this.sandbox.getContentEditable(): this.doc.body;this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1));this.selection=new a.Selection(this.parent,this.element,this.config.uneditableContainerClassname);this.commands=new a.Commands(this.parent);this.config.noTextarea||f.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element);f.addClass(this.element,this.config.composerClassName);this.config.style&& !this.config.contentEditableMode&&this.style();this.observe();var d=this.config.name;d&&(f.addClass(this.element,d),this.config.contentEditableMode||f.addClass(this.editableArea,d));this.enable();!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();(d="string"===typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&f.simulatePlaceholder(this.parent,this, d);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();this._initLineBreaking();this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||b.isIos()||setTimeout(function(){g.focus(!0)},100);b.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this);this.initSync&&this.config.sync&&this.initSync();this.config.noTextarea||this.textarea.hide();this.parent.fire("beforeload").fire("load")}, _initAutoLinking:function(){var g=this,d=b.canDisableAutoLinking(),k=b.doesAutoLinkingInContentEditable();d&&this.commands.exec("autoUrlDetect",!1);if(this.config.autoLink){if(!k||k&&d)this.parent.on("newword:composer",function(){if(f.getTextContent(g.element).match(f.autoLink.URL_REG_EXP)){for(var b=g.selection.getSelectedNode(),e=g.element.querySelectorAll("."+g.config.uneditableContainerClassname),d=!1,h=e.length;h--;)a.dom.contains(e[h],b)&&(d=!0);d||f.autoLink(b,[g.config.uneditableContainerClassname])}}), f.observe(this.element,"blur",function(){f.autoLink(g.element,[g.config.uneditableContainerClassname])});var h=this.sandbox.getDocument().getElementsByTagName("a"),e=f.autoLink.URL_REG_EXP,l=function(b){b=a.lang.string(f.getTextContent(b)).trim();"www."===b.substr(0,4)&&(b="http://"+b);return b};f.observe(this.element,"keydown",function(a){if(h.length){a=g.selection.getSelectedNode(a.target.ownerDocument);var b=f.getParentElement(a,{query:"a"},4),d;b&&(d=l(b),setTimeout(function(){var a=l(b);a!== d&&a.match(e)&&b.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",!0);if(b.supportsEvent("resizeend")){var g=["width","height"],d=g.length,k=this.element;f.observe(k,"resizeend",function(b){b=b.target||b.srcElement;var e=b.style,f=0,p;if("IMG"===b.nodeName){for(;f<d;f++)p=g[f],e[p]&&(b.setAttribute(p,parseInt(e[p],10)),e[p]="");a.quirks.redraw(k)}})}},_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function g(a){var b= f.getParentElement(a,{query:"p, div"},2);b&&f.contains(d.element,b)&&d.selection.executeAndRestore(function(){d.config.useLineBreaks?f.replaceWithChildNodes(b):"P"!==b.nodeName&&f.renameElement(b,"p")})}var d=this;this.config.useLineBreaks||f.observe(this.element,["focus","keydown"],function(){if(d.isEmpty()){var a=d.doc.createElement("P");d.element.innerHTML="";d.element.appendChild(a);b.displaysCaretInEmptyContentEditableCorrectly()?d.selection.selectNode(a,!0):(a.innerHTML="<br>",d.selection.setBefore(a.firstChild))}}); f.observe(this.element,"keydown",function(b){var h=b.keyCode;if(!b.shiftKey&&(h===a.ENTER_KEY||h===a.BACKSPACE_KEY)){var e=f.getParentElement(d.selection.getSelectedNode(),{query:"li, p, h1, h2, h3, h4, h5, h6"},4);e?setTimeout(function(){var b=d.selection.getSelectedNode(),k;if("LI"===e.nodeName){if(!b)return;(k=f.getParentElement(b,{query:"ul, ol, menu"},2))||g(b)}h===a.ENTER_KEY&&e.nodeName.match(/^H[1-6]$/)&&g(b)},0):d.config.useLineBreaks&&h===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&& (b.preventDefault(),d.commands.exec("insertLineBreak"))}})}})})(wysihtml5); (function(a){var f=a.dom,b=document,g=window,d=b.createElement("div"),k="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),h="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),e= ["html { height: 100%; }","body { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(a){if(a.setActive)try{a.setActive()}catch(e){}else{var d=a.style,h=b.documentElement.scrollTop|| b.body.scrollTop,k=b.documentElement.scrollLeft||b.body.scrollLeft,d={position:d.position,top:d.top,left:d.left,WebkitUserSelect:d.WebkitUserSelect};f.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a);a.focus();f.setStyles(d).on(a);g.scrollTo&&g.scrollTo(k,h)}};a.views.Composer.prototype.style=function(){var g=this,m=b.querySelector(":focus"),n=this.textarea.element,q=n.hasAttribute("placeholder"),r=q&&n.getAttribute("placeholder"),v=n.style.display,t=n.disabled, w;this.focusStylesHost=d.cloneNode(!1);this.blurStylesHost=d.cloneNode(!1);this.disabledStylesHost=d.cloneNode(!1);q&&n.removeAttribute("placeholder");n===m&&n.blur();n.disabled=!1;n.style.display=w="none";if(n.getAttribute("rows")&&"auto"===f.getStyle("height").from(n)||n.getAttribute("cols")&&"auto"===f.getStyle("width").from(n))n.style.display=w=v;f.copyStyles(h).from(n).to(this.editableArea).andTo(this.blurStylesHost);f.copyStyles(k).from(n).to(this.element).andTo(this.blurStylesHost);f.insertCSS(e).into(this.element.ownerDocument); n.disabled=!0;f.copyStyles(h).from(n).to(this.disabledStylesHost);f.copyStyles(k).from(n).to(this.disabledStylesHost);n.disabled=t;n.style.display=v;l(n);n.style.display=w;f.copyStyles(h).from(n).to(this.focusStylesHost);f.copyStyles(k).from(n).to(this.focusStylesHost);n.style.display=v;f.copyStyles(["display"]).from(n).to(this.editableArea);var x=a.lang.array(h).without(["display"]);m?m.focus():n.blur();q&&n.setAttribute("placeholder",r);this.parent.on("focus:composer",function(){f.copyStyles(x).from(g.focusStylesHost).to(g.editableArea); f.copyStyles(k).from(g.focusStylesHost).to(g.element)});this.parent.on("blur:composer",function(){f.copyStyles(x).from(g.blurStylesHost).to(g.editableArea);f.copyStyles(k).from(g.blurStylesHost).to(g.element)});this.parent.observe("disable:composer",function(){f.copyStyles(x).from(g.disabledStylesHost).to(g.editableArea);f.copyStyles(k).from(g.disabledStylesHost).to(g.element)});this.parent.observe("enable:composer",function(){f.copyStyles(x).from(g.blurStylesHost).to(g.editableArea);f.copyStyles(k).from(g.blurStylesHost).to(g.element)}); return this}})(wysihtml5); (function(a){var f=a.dom,b=a.browser,g={66:"bold",73:"italic",85:"underline"},d=function(a,b,e){for(var d=0,f=b.length;d<f;d++)a.addEventListener(b[d],e,!1)},k=function(a,b){var e=b.selection;if(e.isCollapsed())if(e.caretIsInTheBeginnig("li"))a.preventDefault(),b.commands.exec("outdentList");else if(e.caretIsInTheBeginnig())a.preventDefault();else{if(e.caretIsFirstInSelection()&&e.getPreviousNode()&&e.getPreviousNode().nodeName&&/^H\d$/gi.test(e.getPreviousNode().nodeName)){var d=e.getPreviousNode(); a.preventDefault();if(/^\s*$/.test(d.textContent||d.innerText))d.parentNode.removeChild(d);else{var f=d.ownerDocument.createRange();f.selectNodeContents(d);f.collapse(!1);e.setSelection(f)}}if(e=e.caretIsBeforeUneditable()){a.preventDefault();try{var g=new CustomEvent("wysihtml5:uneditable:delete");e.dispatchEvent(g)}catch(h){}e.parentNode.removeChild(e)}}else e.containsUneditable()&&(a.preventDefault(),e.deleteContents())},h=function(a){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval); this.parent.fire("destroy:composer")},e=function(a){this.parent.fire("beforeinteraction").fire("beforeinteraction:composer");setTimeout(function(){this.parent.fire("interaction").fire("interaction:composer")}.bind(this),0)},l=function(a){this.parent.fire("focus",a).fire("focus:composer",a);setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},p=function(a){if(this.focusState!==this.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}})); this.parent.fire("change",b).fire("change:composer",b)}this.parent.fire("blur",a).fire("blur:composer",a)},m=function(a){this.parent.fire(a.type,a).fire(a.type+":composer",a);"paste"===a.type&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},n=function(a){this.config.copyedFromMarking&&(a.clipboardData&&(a.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),a.clipboardData.setData("text/plain",this.selection.getPlainText()),a.preventDefault()), this.parent.fire(a.type,a).fire(a.type+":composer",a))},q=function(b){b=b.keyCode;b!==a.SPACE_KEY&&b!==a.ENTER_KEY||this.parent.fire("newword:composer")},r=function(e){if(!b.canSelectImagesInContentEditable()){e=e.target;var d=this.element.querySelectorAll("img"),f=this.element.querySelectorAll("."+this.config.uneditableContainerClassname+" img"),d=a.lang.array(d).without(f);"IMG"===e.nodeName&&a.lang.array(d).contains(e)&&this.selection.selectNode(e)}},v=function(a){var b={IMG:"Image: ",A:"Link: "}; a=a.target;var e=a.nodeName;"A"!==e&&"IMG"!==e||a.hasAttribute("title")||(b=b[e]+(a.getAttribute("href")||a.getAttribute("src")),a.setAttribute("title",b))},t=function(b){this.config.uneditableContainerClassname&&(b=a.dom.getParentElement(b.target,{query:"."+this.config.uneditableContainerClassname},!1,this.element))&&this.selection.setAfter(b)},w=function(a){b.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},x=function(b){var e= b.keyCode,d=g[e],f;(b.ctrlKey||b.metaKey)&&!b.altKey&&d&&(this.commands.exec(d),b.preventDefault());e===a.BACKSPACE_KEY&&k(b,this);(e===a.BACKSPACE_KEY||e===a.DELETE_KEY)&&(d=this.selection.getSelectedNode(!0))&&"IMG"===d.nodeName&&(b.preventDefault(),f=d.parentNode,f.removeChild(d),"A"!==f.nodeName||f.firstChild||f.parentNode.removeChild(f),setTimeout(function(){a.quirks.redraw(this.element)},0));if(this.config.handleTabKey&&e===a.TAB_KEY)a:{if(b.preventDefault(),!this.selection.isCollapsed())this.selection.deleteContents(); else if(this.selection.caretIsInTheBeginnig("li")&&this.commands.exec("indentList"))break a;this.commands.exec("insertHTML","&emsp;")}},B=function(a){setTimeout(function(){this.doc.querySelector(":focus")!==this.element&&this.focus()}.bind(this),0)},D=function(a){setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},F=function(){var b=function(){this.doc.execCommand("enableObjectResizing",!1,"false");this.doc.execCommand("enableInlineTableEditing",!1,"false")},e=function(){b.call(this); for(var a=this.sandbox.getIframe(),d=["focus","mouseup","mouseover"],f=e,g=0,h=d.length;g<h;g++)a.removeEventListener(d[g],f,!1)}.bind(this);this.doc.execCommand&&a.browser.supportsCommand(this.doc,"enableObjectResizing")&&a.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?d(this.sandbox.getIframe(),["focus","mouseup","mouseover"],e):setTimeout(function(){b.call(this)}.bind(this),0));this.tableSelection=a.quirks.tableCellsSelection(this.element,this.parent)};a.views.Composer.prototype.observe= function(){var a=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),g=b.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow();this.focusState=this.getValue(!1,!1);a.addEventListener(["DOMNodeRemoved"],h.bind(this),!1);b.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){f.contains(document.documentElement,a)||h.call(this)},250));this.config.handleTables&&F.call(this);d(g,["drop","paste","mouseup", "focus","keyup"],e.bind(this));g.addEventListener("focus",l.bind(this),!1);g.addEventListener("blur",p.bind(this),!1);d(this.element,["drop","paste","beforepaste"],m.bind(this),!1);this.element.addEventListener("copy",n.bind(this),!1);this.element.addEventListener("mousedown",r.bind(this),!1);this.element.addEventListener("mouseover",v.bind(this),!1);this.element.addEventListener("click",t.bind(this),!1);this.element.addEventListener("drop",w.bind(this),!1);this.element.addEventListener("keyup",q.bind(this), !1);this.element.addEventListener("keydown",x.bind(this),!1);this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1);!this.config.contentEditableMode&&b.hasIframeFocusIssue()&&(a.addEventListener("focus",B.bind(this),!1),a.addEventListener("blur",D.bind(this),!1))}})(wysihtml5); (function(a){a.views.Synchronizer=Base.extend({constructor:function(a,b,g){this.editor=a;this.textarea=b;this.composer=g;this._observe()},fromComposerToTextarea:function(f){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),f)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(!1,!1);b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a): this.fromComposerToTextarea(a)},_observe:function(){var f,b=this,g=this.textarea.element.form,d=function(){f=setInterval(function(){b.fromComposerToTextarea()},400)},k=function(){clearInterval(f);f=null};d();g&&(a.dom.observe(g,"submit",function(){b.sync(!0)}),a.dom.observe(g,"reset",function(){setTimeout(function(){b.fromTextareaToComposer()},0)}));this.editor.on("change_view",function(a){"composer"!==a||f?"textarea"===a&&(b.fromComposerToTextarea(!0),k()):(b.fromTextareaToComposer(!0),d())});this.editor.on("destroy:composer", k)}})})(wysihtml5); wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(a,f,b){this.base(a,f,b);this._observe()},clear:function(){this.element.value=""},getValue:function(a){var f=this.isEmpty()?"":this.element.value;!1!==a&&(f=this.parent.parse(f));return f},setValue:function(a,f){f&&(a=this.parent.parse(a));this.element.value=a},cleanUp:function(){var a=this.parent.parse(this.element.value);this.element.value=a},hasPlaceholderSet:function(){var a=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),f= this.element.getAttribute("placeholder")||null,b=this.element.value;return a&&!b||b===f},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,f=this.parent,b={focusin:"focus",focusout:"blur"},g=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];f.on("beforeload",function(){wysihtml5.dom.observe(a,g,function(a){a=b[a.type]||a.type;f.fire(a).fire(a+":textarea")}); wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){f.fire("paste").fire("paste:textarea")},0)})})}}); (function(a){var f={name:void 0,style:!0,toolbar:void 0,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:void 0,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'}; a.Editor=a.lang.Dispatcher.extend({constructor:function(b,g){this.editableElement="string"===typeof b?document.getElementById(b):b;this.config=a.lang.object({}).merge(f).merge(g).get();this._isCompatible=a.browser.supported();"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0);this.config.noTextarea||(this.currentView=this.textarea=new a.views.Textarea(this,this.editableElement,this.config));if(!this._isCompatible||!this.config.supportTouchDevices&& a.browser.isTouchDevice()){var d=this;setTimeout(function(){d.fire("beforeload").fire("load")},0)}else a.dom.addClass(document.body,this.config.bodyClassName),this.currentView=this.composer=new a.views.Composer(this,this.editableElement,this.config),"function"===typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer));this.config.toolbar&& (this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(a,f){return this.currentView.getValue(a,f)},setValue:function(a,f){this.fire("unset_placeholder");if(!a)return this.clear();this.currentView.setValue(a,f);return this},cleanUp:function(){this.currentView.cleanUp()},focus:function(a){this.currentView.focus(a);return this},disable:function(){this.currentView.disable(); return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(b,f){var d=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,d=this.config.parser(b,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:d,uneditableClass:this.config.uneditableContainerClassname,clearInternals:f});"object"===typeof b&& a.quirks.redraw(b);return d},_initParser:function(){var b=this,f;if(a.browser.supportsModenPaste())this.on("paste:composer",function(d){d.preventDefault();(f=a.dom.getPastedHtml(d))&&b._cleanAndPaste(f)});else this.on("beforepaste:composer",function(d){d.preventDefault();a.dom.getPastedHtmlWithDiv(b.composer,function(a){a&&b._cleanAndPaste(a)})})},_cleanAndPaste:function(b){b=a.quirks.cleanPastedHTML(b,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}], uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents();this.composer.selection.insertHTML(b)}})})(wysihtml5); (function(a){var f=a.dom;a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,f){this.link=a;this.container=f},_observe:function(){if(!this._observed){var b=this,g=function(a){var e=b._serialize();b.fire("save",e);b.hide();a.preventDefault();a.stopPropagation()};f.observe(b.link,"click",function(){f.hasClass(b.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){b.hide()},0)});f.observe(this.container,"keydown",function(e){var d=e.keyCode;d===a.ENTER_KEY&&g(e);d===a.ESCAPE_KEY&& (b.fire("cancel"),b.hide())});f.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",g);f.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(a){b.fire("cancel");b.hide();a.preventDefault();a.stopPropagation()});for(var d=this.container.querySelectorAll("input, select, textarea"),k=0,h=d.length,e=function(){clearInterval(b.interval)};k<h;k++)f.observe(d[k],"change",e);this._observed=!0}},_serialize:function(){for(var a={},f=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"), d=f.length,k=0;k<d;k++)a[f[k].getAttribute("data-wysihtml5-dialog-field")]=f[k].value;return a},_interpolate:function(a){for(var f,d,k=document.querySelector(":focus"),h=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),e=h.length,l=0;l<e;l++)f=h[l],f===k||a&&"hidden"===f.type||(d=f.getAttribute("data-wysihtml5-dialog-field"),d=this.elementToChange&&"boolean"!==typeof this.elementToChange?this.elementToChange.getAttribute(d)||"":f.defaultValue,f.value=d)},show:function(a){if(!f.hasClass(this.link, "wysihtml5-command-dialog-opened")){var g=this,d=this.container.querySelector("input, select, textarea");this.elementToChange=a;this._observe();this._interpolate();a&&(this.interval=setInterval(function(){g._interpolate(!0)},500));f.addClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="";this.fire("show");if(d&&!a)try{d.focus()}catch(k){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;f.removeClass(this.link,"wysihtml5-command-dialog-opened"); this.container.style.display="none";this.fire("hide")}})})(wysihtml5); (function(a){var f=a.dom,b={position:"relative"},g={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},d={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},k={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(h,e){var l=document.createElement("input");if(a.browser.supportsSpeechApiOn(l)){var p=h.editor.textarea.element.getAttribute("lang");p&&(k.lang=p);p=document.createElement("div"); a.lang.object(g).merge({width:e.offsetWidth+"px",height:e.offsetHeight+"px"});f.insert(l).into(p);f.insert(p).into(e);f.setStyles(d).on(l);f.setAttributes(k).on(l);f.setStyles(g).on(p);f.setStyles(b).on(e);f.observe(l,"onwebkitspeechchange"in l?"webkitspeechchange":"speechchange",function(){h.execCommand("insertText",l.value);l.value=""});f.observe(l,"click",function(a){f.hasClass(e,"wysihtml5-command-disabled")&&a.preventDefault();a.stopPropagation()})}else e.style.display="none"}})(wysihtml5); (function(a){var f="wysihtml5-command-disabled",b="wysihtml5-commands-disabled",g="wysihtml5-command-active",d="wysihtml5-action-active",k=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(h,e,k){this.editor=h;this.container="string"===typeof e?document.getElementById(e):e;this.composer=h.composer;this._getLinks("command");this._getLinks("action");this._observe();k&&this.show();null!=h.config.classNameCommandDisabled&&(f=h.config.classNameCommandDisabled);null!=h.config.classNameCommandsDisabled&& (b=h.config.classNameCommandsDisabled);null!=h.config.classNameCommandActive&&(g=h.config.classNameCommandActive);null!=h.config.classNameActionActive&&(d=h.config.classNameActionActive);h=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]");e=h.length;for(k=0;k<e;k++)new a.toolbar.Speech(this,h[k])},_getLinks:function(b){for(var e=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+b+"]")).get(),d=e.length,f=0,g=this[b+"Mapping"]={},k,q,r,v,t,w;f<d;f++)k= e[f],r=k.getAttribute("data-wysihtml5-"+b),v=k.getAttribute("data-wysihtml5-"+b+"-value"),w=k.getAttribute("data-wysihtml5-"+b+"-blank-value"),q=this.container.querySelector("[data-wysihtml5-"+b+"-group='"+r+"']"),t=this._getDialog(k,r),g[r+":"+v]={link:k,group:q,name:r,value:v,tracksBlankValue:w,dialog:t,state:!1}},_getDialog:function(b,e){var d=this,f=this.container.querySelector("[data-wysihtml5-dialog='"+e+"']"),g,k;f&&(g=a.toolbar["Dialog_"+e]?new a.toolbar["Dialog_"+e](b,f):new a.toolbar.Dialog(b, f),g.on("show",function(){k=d.composer.selection.getBookmark();d.editor.fire("show:dialog",{command:e,dialogContainer:f,commandLink:b})}),g.on("save",function(a){k&&d.composer.selection.setBookmark(k);d._execCommand(e,a);d.editor.fire("save:dialog",{command:e,dialogContainer:f,commandLink:b})}),g.on("cancel",function(){d.editor.focus(!1);d.editor.fire("cancel:dialog",{command:e,dialogContainer:f,commandLink:b})}));return g},execCommand:function(a,b){if(!this.commandsDisabled){var d=this.commandMapping[a+ ":"+b];d&&d.dialog&&!d.state?d.dialog.show():this._execCommand(a,b)}},_execCommand:function(a,b){this.editor.focus(!1);this.composer.commands.exec(a,b);this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&b.textarea&&(b.currentView===b.textarea?b.fire("change_view","composer"):b.fire("change_view","textarea"));"showSource"==a&&b.fire("showSource")},_observe:function(){for(var a=this,e=this.editor,d=this.container,f=this.commandLinks.concat(this.actionLinks),g=f.length, n=0;n<g;n++)if("A"===f[n].nodeName)k.setAttributes({href:"javascript:;",unselectable:"on"}).on(f[n]);else k.setAttributes({unselectable:"on"}).on(f[n]);k.delegate(d,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(a){a.preventDefault()});k.delegate(d,"[data-wysihtml5-command]","click",function(b){var d=this.getAttribute("data-wysihtml5-command"),e=this.getAttribute("data-wysihtml5-command-value");a.execCommand(d,e);b.preventDefault()});k.delegate(d,"[data-wysihtml5-action]", "click",function(b){var d=this.getAttribute("data-wysihtml5-action");a.execAction(d);b.preventDefault()});e.on("interaction:composer",function(){a._updateLinkStates()});e.on("focus:composer",function(){a.bookmark=null});this.editor.config.handleTables&&(e.on("tableselect:composer",function(){a.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),e.on("tableunselect:composer",function(){a.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display= "none"}));e.on("change_view",function(f){e.textarea&&setTimeout(function(){a.commandsDisabled="composer"!==f;a._updateLinkStates();a.commandsDisabled?k.addClass(d,b):k.removeClass(d,b)},0)})},_updateLinkStates:function(){var b=this.commandMapping,e=this.actionMapping,l,p,m;for(l in b)if(m=b[l],this.commandsDisabled?(p=!1,k.removeClass(m.link,g),m.group&&k.removeClass(m.group,g),m.dialog&&m.dialog.hide()):(p=this.composer.commands.state(m.name,m.value),k.removeClass(m.link,f),m.group&&k.removeClass(m.group, f)),m.state!==p||m.tracksBlankValue)(m.state=p)?m.tracksBlankValue?k.removeClass(m.link,g):(k.addClass(m.link,g),m.group&&k.addClass(m.group,g),m.dialog&&("object"===typeof p||a.lang.object(p).isArray()?(!m.dialog.multiselect&&a.lang.object(p).isArray()&&(p=1===p.length?p[0]:!0,m.state=p),m.dialog.show(p)):m.dialog.hide())):m.tracksBlankValue?k.addClass(m.link,g):(k.removeClass(m.link,g),m.group&&k.removeClass(m.group,g),m.dialog&&m.dialog.hide());for(l in e)b=e[l],"change_view"===b.name&&(b.state= this.editor.currentView===this.editor.textarea,b.state?k.addClass(b.link,d):k.removeClass(b.link,d))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(a){this.base(a)}})})(wysihtml5); (function(a){a.toolbar.Dialog_foreColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},b=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),g=b.length,d=0;d<g;d++)a[b[d].getAttribute("data-wysihtml5-dialog-field")]=b[d].value;return a},_interpolate:function(f){for(var b,g=document.querySelector(":focus"),d=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),k=d.length,h=0,e=(b=(b=this.elementToChange?a.lang.object(this.elementToChange).isArray()? this.elementToChange[0]:this.elementToChange:null)?b.getAttribute("style"):null)?a.quirks.styleParser.parseColor(b,"color"):null;h<k;h++)b=d[h],b===g||f&&"hidden"===b.type||"color"!==b.getAttribute("data-wysihtml5-dialog-field")||(b.value=e?e[3]&&1!=e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+");":"rgb("+e[0]+","+e[1]+","+e[2]+");":"rgb(0,0,0);")}})})(wysihtml5); (function(a){a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(f){f=document.querySelector(":focus");var b=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),g=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,g=(g=g?g.getAttribute("style"):null)?a.quirks.styleParser.parseFontSize(g): null;b&&b!==f&&g&&!/^\s*$/.test(g)&&(b.value=g)}})})(wysihtml5);